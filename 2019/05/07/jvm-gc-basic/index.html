<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon/favicon-16x16.png">
  <link rel="mask-icon" href="/images/favicon/safari-pinned-tab.svg" color="#222">
  <link rel="manifest" href="/images/favicon/manifest.json">
  <meta name="google-site-verification" content="yL1R2eDsKDqjPNaOBKp1usSDw8SQNzaO35svs1LKYWw">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css" integrity="sha256-jTIdiMuX/e3DGJUGwl3pKSxuc6YOuqtJYkM0bGQESA4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"perfectacle.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":true,"version":"8.10.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"manual"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"disqus","storage":true,"lazyload":false,"nav":null,"activeClass":"disqus"},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":true}}</script><script src="/js/config.js"></script>

    <meta name="description" content="읽기 전 주의사항(그림을 보는 법)그림을 그리다보니 Stack에 있는 동그라미 모양과 힙 메모리에 있는 동그라미 모양이 동일한 그림들이 많이 있습니다.이건 둘이 동일한 메모리를 의미하는 게 아니라 그냥 스택에서 힙을 참조한다는 걸 그린 건데,사실 둘의 모양을 다르게 그려야하는데 아무 생각없이 복붙해서 그리다보니 이렇게 그리게 되었고…되돌리기에는 너무">
<meta property="og:type" content="article">
<meta property="og:title" content="(JVM) Garbage Collection Basic">
<meta property="og:url" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/index.html">
<meta property="og:site_name" content="오늘도 끄적끄적">
<meta property="og:description" content="읽기 전 주의사항(그림을 보는 법)그림을 그리다보니 Stack에 있는 동그라미 모양과 힙 메모리에 있는 동그라미 모양이 동일한 그림들이 많이 있습니다.이건 둘이 동일한 메모리를 의미하는 게 아니라 그냥 스택에서 힙을 참조한다는 걸 그린 건데,사실 둘의 모양을 다르게 그려야하는데 아무 생각없이 복붙해서 그리다보니 이렇게 그리게 되었고…되돌리기에는 너무">
<meta property="og:locale" content="ko_KR">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/thumb.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/optimizing-java.jpeg">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/stop-the-world.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/mark-and-sweep-01.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/mark-and-sweep-02.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/mark-and-sweep-03.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/mark-and-sweep-04.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/c-01.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/c-02.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/eden-space-01.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/eden-space-02.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/eden-space-03.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/eden-space-04.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/survivor-space-01.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/survivor-space-02.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/survivor-space-03.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/survivor-space-04.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/survivor-space-05.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/minor-gc-01.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/minor-gc-02.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/minor-gc-03.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/minor-gc-04.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/minor-gc-05.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/minor-gc-06.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/minor-gc-07.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/minor-gc-08.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/minor-gc-09.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/minor-gc-10.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/minor-gc-11.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/minor-gc-12.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/minor-gc-13.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/minor-gc-14.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/minor-gc-15.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/minor-gc-16.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/minor-gc-17.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/minor-gc-18.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/minor-gc-19.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/minor-gc-20.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/minor-gc-21.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/minor-gc-22.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/minor-gc-23.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/minor-gc-24.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/minor-gc-25.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/promotion-01.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/promotion-02.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/premature-promotion-01.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/premature-promotion-02.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/premature-promotion-03.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/premature-promotion-04.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/premature-promotion-04.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/premature-promotion-06.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/mat.png">
<meta property="og:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/visual-vm.png">
<meta property="article:published_time" content="2019-05-07T01:43:52.000Z">
<meta property="article:modified_time" content="2022-03-12T09:48:36.715Z">
<meta property="article:author" content="양권성">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="JVM">
<meta property="article:tag" content="GC">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/thumb.png">


<link rel="canonical" href="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"ko","comments":true,"permalink":"https://perfectacle.github.io/2019/05/07/jvm-gc-basic/","path":"2019/05/07/jvm-gc-basic/","title":"(JVM) Garbage Collection Basic"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>(JVM) Garbage Collection Basic | 오늘도 끄적끄적</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-87795455-1"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-87795455-1","only_pageview":false}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>




<!--<script data-ad-client="ca-pub-3881550906962162" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>-->
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="오늘도 끄적끄적" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">오늘도 끄적끄적</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">느리더라도 꾸준하게</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>홈</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>태그<span class="badge">249</span></a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>카테고리<span class="badge">46</span></a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>아카이브<span class="badge">211</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>검색
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          목차
        </li>
        <li class="sidebar-nav-overview">
          흝어보기
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%EC%9D%BD%EA%B8%B0-%EC%A0%84-%EC%A3%BC%EC%9D%98%EC%82%AC%ED%95%AD-%EA%B7%B8%EB%A6%BC%EC%9D%84-%EB%B3%B4%EB%8A%94-%EB%B2%95"><span class="nav-number">1.</span> <span class="nav-text">읽기 전 주의사항(그림을 보는 법)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%EB%93%A4%EC%96%B4%EA%B0%80%EA%B8%B0%EC%97%90-%EC%95%9E%EC%84%9C"><span class="nav-number">2.</span> <span class="nav-text">들어가기에 앞서</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mark-and-Sweep-Algorithm"><span class="nav-number">3.</span> <span class="nav-text">Mark and Sweep Algorithm</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Weak-Generational-%EA%B0%80%EC%84%A4"><span class="nav-number">4.</span> <span class="nav-text">Weak Generational 가설</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Young-Generation"><span class="nav-number">5.</span> <span class="nav-text">Young Generation</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Eden-Space"><span class="nav-number">5.1.</span> <span class="nav-text">Eden Space</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Survivor-Space"><span class="nav-number">5.2.</span> <span class="nav-text">Survivor Space</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Survivor-Space%EB%8A%94-%EC%99%9C-2%EA%B0%9C%EC%9D%BC%EA%B9%8C"><span class="nav-number">5.2.1.</span> <span class="nav-text">Survivor Space는 왜 2개일까?</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Minor-GC"><span class="nav-number">5.3.</span> <span class="nav-text">Minor GC</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Promotion"><span class="nav-number">5.3.1.</span> <span class="nav-text">Promotion</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Premature-Promotion"><span class="nav-number">5.3.2.</span> <span class="nav-text">Premature Promotion</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Old-Generation"><span class="nav-number">6.</span> <span class="nav-text">Old Generation</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Major-GC"><span class="nav-number">6.1.</span> <span class="nav-text">Major GC</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Full-GC"><span class="nav-number">7.</span> <span class="nav-text">Full GC</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Permanent-Generation"><span class="nav-number">8.</span> <span class="nav-text">Permanent Generation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Metadata"><span class="nav-number">9.</span> <span class="nav-text">Metadata</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#OutOfMemoryException"><span class="nav-number">10.</span> <span class="nav-text">OutOfMemoryException</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%EC%95%8C%EC%95%84%EB%91%90%EB%A9%B4-%EC%A2%8B%EC%9D%84-%EC%83%81%EC%8B%9D"><span class="nav-number">11.</span> <span class="nav-text">알아두면 좋을 상식</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%EB%A7%88%EC%B9%98%EB%A9%B0"><span class="nav-number">12.</span> <span class="nav-text">마치며</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%EC%B0%B8%EC%A1%B0-%EB%A7%81%ED%81%AC"><span class="nav-number">13.</span> <span class="nav-text">참조 링크</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="양권성" src="/images/avatar/avatar.png">
  <p class="site-author-name" itemprop="name">양권성</p>
  <div class="site-description" itemprop="description">Toss Server Developer</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">211</span>
          <span class="site-state-item-name">포스트</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">46</span>
        <span class="site-state-item-name">카테고리</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">249</span>
        <span class="site-state-item-name">태그</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/perfectacle" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;perfectacle" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:perfectacle@gmail.com" title="E-Mail → mailto:perfectacle@gmail.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.facebook.com/perfectacle" title="FB Page → https:&#x2F;&#x2F;www.facebook.com&#x2F;perfectacle" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-facebook fa-fw"></i></a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="ko">
    <link itemprop="mainEntityOfPage" href="https://perfectacle.github.io/2019/05/07/jvm-gc-basic/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar/avatar.png">
      <meta itemprop="name" content="양권성">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="오늘도 끄적끄적">
      <meta itemprop="description" content="Toss Server Developer">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="(JVM) Garbage Collection Basic | 오늘도 끄적끄적">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          (JVM) Garbage Collection Basic
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">작성일</span>

      <time title="Post created: 2019-05-07 01:43:52" itemprop="dateCreated datePublished" datetime="2019-05-07T01:43:52+00:00">2019-05-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Updated at: 2022-03-12 09:48:36" itemprop="dateModified" datetime="2022-03-12T09:48:36+00:00">2022-03-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming/" itemprop="url" rel="index"><span itemprop="name">Programming</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2019/05/07/jvm-gc-basic/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/05/07/jvm-gc-basic/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <img src="/2019/05/07/jvm-gc-basic/thumb.png" class title="PermGen은 자바 8에서 Metaspcae로 대체됐다. 이미지 출처: https:&#x2F;&#x2F;help.sap.com&#x2F;">  

<h2 id="읽기-전-주의사항-그림을-보는-법"><a href="#읽기-전-주의사항-그림을-보는-법" class="headerlink" title="읽기 전 주의사항(그림을 보는 법)"></a>읽기 전 주의사항(그림을 보는 법)</h2><p>그림을 그리다보니 Stack에 있는 동그라미 모양과 힙 메모리에 있는 동그라미 모양이 동일한 그림들이 많이 있습니다.<br>이건 <strong>둘이 동일한 메모리를 의미하는 게 아니라 그냥 스택에서 힙을 참조</strong>한다는 걸 그린 건데,<br>사실 둘의 모양을 다르게 그려야하는데 아무 생각없이 복붙해서 그리다보니 이렇게 그리게 되었고…<br>되돌리기에는 너무 많이 그림을 그려놔서(히스토리 추적이 안 되게 막 그려서…) 귀챠니즘으로 인해 그림을 수정하지 않았습니다.<br>이 점 참고하셔서 보시길 바랍니다!</p>
<h2 id="들어가기에-앞서"><a href="#들어가기에-앞서" class="headerlink" title="들어가기에 앞서"></a>들어가기에 앞서</h2><img src="/2019/05/07/jvm-gc-basic/optimizing-java.jpeg" class>
<p>이 글은 이일웅 님께서 번역하신 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://book.naver.com/bookdb/book_detail.nhn?bid=14796595">자바 최적화</a>란 책을 읽던 도중 공부한 내용을 정리한 글입니다.<br>절대 해당 책의 홍보는 아니며 좋은 책을 써준 사람과 번역해주신 분께 진심으로 감사하는 마음에 썼습니다. </p>
<p>자바는 C언어와 달리 프로그래머가 일일이 쓰지 않는 메모리(가비지)를 회수할 필요가 없게 끔 가비지 컬렉터가 알아서 열일한다.<br>자바의 모든 가비지 컬렉션에는 Stop the World(어플리케이션 스레드를 모두 멈추기 때문에 어플리케이션이 멈추게 된다.)가 발생하고 GC 쓰레드만 열일하게 된다.  </p>
<img src="/2019/05/07/jvm-gc-basic/stop-the-world.png" class title="죠죠의 기묘한 모험이 떠오르는 건 왜일까... 출처: https:&#x2F;&#x2F;www.youtube.com&#x2F;watch?v&#x3D;_cNXjmuhCCc">  
<p>저수준 세부를 일일이 신경쓰지 않는 대가로 저수준 제어권을 포기한다는 사상이 자바의 핵심이다.</p>
<blockquote>
<p>자바는 블루 컬러(주로 생산직에 종사하는 육체 노동자) 언어입니다.<br>  박사 학위 논문 주제가 아니라 일을 하려고 만든 언어죠.<br>  — 제임스 고슬링(자바의 아버지) —</p>
</blockquote>
<p>즉, 일일이 메모리 해제하는 걸 ‘박사 학위 논문 주제’ 급의 어려운 일이라고 자바에서 여기는 것이다.<br>이런 어려운 일은 우리가 할테니 너희는 일을 해라!(비즈니스 로직이나 짜라!) 이런 뉘앙스 같다.</p>
<p>GC는 아래 두 가지 원칙을 준수해야한다. (프로그래머가 일일이 메모리 해제하다간 이런 유형의 휴먼 에러가 발생한다는 걸 보여준다.)</p>
<ul>
<li>반드시 모든 가비지(쓰지 않는 메모리)를 수집(free)해야한다.<br>메모리만 엄~청 빵빵하다면 가비지가 많더라도 굳이 메모리 해제할 필요가 없다.<br>사실 GC도 메모리가 부족할 때만 수행한다.</li>
<li>살아있는 객체(접근 가능한 객체)는 절대로 수집해선 안 된다.<br>C언어에서는 살아있는 객체(접근 가능한 객체)를 해제하면 Dangling pointer가 만들어지고, 어플리케이션이 뻗거나 해당 메모리에 다른 데이터가 할당돼서 해당 데이터를 더럽히는 등의 버그가 발생하게 된다.<br>자바에서는 살아있는 객체를 수집해가면 나중에 참조하는 쪽에서 NPE(NullPointerException) 등등이 발생할 가능성이 높다.</li>
</ul>
<h2 id="Mark-and-Sweep-Algorithm"><a href="#Mark-and-Sweep-Algorithm" class="headerlink" title="Mark and Sweep Algorithm"></a>Mark and Sweep Algorithm</h2><p>자바의 GC 알고리듬의 기본은 Mark(살아있는 객체를 표시) and Sweep(쓸어담기) 알고리듬이다.</p>
<img src="/2019/05/07/jvm-gc-basic/mark-and-sweep-01.png" class title="GC 루트(스택 프레임, 전역 객체 등등과 같이 메모리 풀 외부에서 내부를 가리키는 포인터)로부터 살아있는 객체(접근 가능한 객체)를 찾는다.">
<img src="/2019/05/07/jvm-gc-basic/mark-and-sweep-02.png" class title="살아있는 객체를 찾으면 mark bit를 true(혹은 1)로 세팅한다.">
<img src="/2019/05/07/jvm-gc-basic/mark-and-sweep-03.png" class title="모든 객체에 대해 마크가 끝났으면 이제 mark bit가 false(혹은 0)인 객체를 찾는다.">
<img src="/2019/05/07/jvm-gc-basic/mark-and-sweep-04.png" class title="mark bit가 false(혹은 0)인 객체는 죽은 객체(접근 불가능한 객체)이므로 가비지 컬렉터가 수거해간다.">

<h2 id="Weak-Generational-가설"><a href="#Weak-Generational-가설" class="headerlink" title="Weak Generational 가설"></a>Weak Generational 가설</h2><blockquote>
<p>JVM 및 유사 소프트웨어에서 객체 수명은 이원적 분포 양상을 보인다.<br>대부분의 객체는 아주 짧은 시간만 살아있지만, 나머지 객체는 기대 수명이 훨씬 길다.</p>
</blockquote>
<p>이 법칙은 사람들이 실제 실험과 경험을 토대로 얻어냈다.<br>따라서 GC의 대상인 힙은 아래 두 가지가 핵심이라는 결론이 나왔다.</p>
<ul>
<li>젊은 객체를 빠르게 수집할 수 있도록 설계해야한다.</li>
<li>늙은 객체와 단명 객체를 떼어놓는 게 가장 좋다.</li>
</ul>
<p>Hotspot VM은 Weak Generational 가설을 활용해 아래와 같은 규칙을 만들었다.</p>
<ul>
<li>객체마다 generational count(객체가 지금까지 무사통과한 가비지 컬렉션 횟수)를 센다.</li>
<li>새로운 객체는 Young Generation이라는 공간에 생성된다.</li>
<li>장수했다고 할 정도로 충분히 오래 살아남은 객체들은 별도의 메모리 영역(Old Generation 또는 Tenured Generation)에 보관된다.</li>
</ul>
<p>또한 Weak Generational 가설 중에 **’늙은 객체가 젊은 객체를 참조할 일은 거의 없다.’**는 내용도 있는데 아예 없는 건 아니므로<br>Hotspot VM에서는 카드 테이블(JVM이 관리하는 바이트 배열로 각 요소는 Old Generation 공간의 512 바이트 영역을 가리킨다.)이라는 자료구조에 늙은 객체가 젊은 객체를 참조하는 정보를 기록한다.<br>따라서 Young Generation의 GC가 수행될 때 늙은 객체가 젊은 객체를 참조하는지도 확인해봐야한다.<br>하지만 이 때는 늙은 객체를 전부 뒤져보는 게 아니라 카드 테이블만 뒤져보면 돼서 GC의 수행 속도를 높여준다.</p>
<img src="/2019/05/07/jvm-gc-basic/c-01.png" class title="또한 메모리의 raw address를 가지고 데이터에 접근(역참조) 가능한 C언어 같은 언어는 이렇게 이분법적으로 메모리 영역을 나눈 구조와 맞지 않는다.">  
<img src="/2019/05/07/jvm-gc-basic/c-02.png" class title="Young Generation에서 Old Generation으로 이동한 데이터는 메모리의 raw address도 바뀔텐데, 해당 raw address로 역참조를 했을 때 메모리 재할당으로 인해 다른 값이 튀어나올 가능성이 높기 때문이다.">  
<p>다행히 자바는 메모리의 raw address를 사용하지도 않고, offset 연산자(. 연산자)만으로 필드나 메서드에 액세스 할 수 있기 때문에 이런 문제로부터 자유롭다.</p>
<h2 id="Young-Generation"><a href="#Young-Generation" class="headerlink" title="Young Generation"></a>Young Generation</h2><p>Weak Generational 가설에 따라 단명하는 젊은 객체들만 모아놓은 공간이다.<br>대부분의 객체가 Young Generation에서 사망하시고, 새로 생성된 객체가 할당되기 때문에 GC가 자주 일어나는 영역이다.<br>GC가 일어나는 동안 Stop the World가 발생하는데 이 빈도가 매우 잦기 때문에 Young Generation의 GC는 수행 시간이 짧아야한다.<br>수행 시간이 짧으려면 수거해가는 객체의 수를 줄이면 되고, 객체의 수를 줄이려면 영역의 사이즈를 적당히 줄이면 된다.<br>수행 시간이 짧은 GC이기 때문에 Minor GC라고 부르는 게 아닐까?</p>
<p>Young Generation 사이즈를 지정하는 JVM flag는 -XX:NewSize와 -XX:MaxNewSize이며<br>-XX:NewRatio 속성을 통해 Old Generation 사이즈와 Young Generation 사이즈의 비율을 정할 수 있다.<br>예를 들어 -XX:NewRatio&#x3D;3으로 지정하면 1:3&#x3D;Young:Old 라고 보면 된다.<br>(Young은 힙 메모리의 1&#x2F;4를 먹고, Old는 힙 메모리의 3&#x2F;4를 먹게 되는 것이다.)  </p>
<blockquote>
<p>The parameters NewSize and MaxNewSize bound the young generation size from below and above.<br>Setting these to the same value fixes the young generation,<br>just as setting -Xms and -Xmx to the same value fixes the total heap size.<br>This is useful for tuning the young generation at a finer granularity than the integral multiples allowed by NewRatio.<br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning/sizing.html">https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning/sizing.html</a></p>
</blockquote>
<p>-XX:NewRatio 파라미터보다는 -XX:NewSize와 -XX:MaxNewSize의 사이즈를 동일하게 설정하는 게 튜닝하는데 더 좋다고 한다.<br>아마 동일하게 설정하는 이유는 해당 영역의 사이즈가 동적으로 줄어들고 늘어나게 되면, GC에도 영향을 미치고 기타 Ratio 관련 설정을 재계산해야되기 때문에 성능에 영향을 미치지 않기 때문 아닐까…?</p>
<p>또한 Young Generation의 GC는 자주 일어나기 때문에 수행 시간이 매우 짧아야하니 적어도 Old Generation의 사이즈보다 적게 할당하는 게 일반적이라고 한다.<br>다만 객체의 수명이 긴 객체들이 많거나 새로운 객체의 할당이 별로 없는 객체의 경우는 Young Generation의 사이즈를 좀 더 과감하게 줄이는 등 케이스 바이 케이스로 사이즈를 정해야할 것 같다.<br>이 모든 결정은 추측이 아닌 모니터링을 통해 할당 비율이라던지 기타 등등의 데이터들을 수치화해서 정확한 데이터 기반으로 의사 결정을 내려야할 것이다. <del>(말이 쉽지 ㅠㅠ 어떻게 하는지도 모른다…)</del></p>
<h3 id="Eden-Space"><a href="#Eden-Space" class="headerlink" title="Eden Space"></a>Eden Space</h3><p>Young Generation의 일부분이다.</p>
<img src="/2019/05/07/jvm-gc-basic/eden-space-01.png" class title="새롭게 생성된 객체의 용량이 Eden Space의 용량보다 큰 경우를 제외하고는 Eden 영역에 할당된다.">    
<img src="/2019/05/07/jvm-gc-basic/eden-space-02.png" class title="그러다가 새롭게 할당할 객체의 메모리 확보를 하지 못한 경우, 즉 Eden 영역이 꽉 찬 경우에 Minor GC를 수행하게 된다.">  
<img src="/2019/05/07/jvm-gc-basic/eden-space-03.png" class title="이 때 GC를 수행하게 되면 메모리 단편화가 생기게 되고 이로 인해 객체를 할당할 전체적인 용량은 확보됐지만 연속된 메모리 공간이 없게 된다.">  
<p>OS 레벨에서는 연속된 메모리 공간에 할당하지 않고 쪼개서 할당해도 되긴 하지만 할당하는 데도 오랜 시간이 걸리고, 데이터를 불러올 때도 순차적인 접근이 아니기 때문에 오래 걸리게 된다.<br>또한 JVM의 메모리 할당은 <a href="#%EC%95%8C%EC%95%84%EB%91%90%EB%A9%B4-%EC%A2%8B%EC%9D%84-%EC%83%81%EC%8B%9D">알아두면 좋을 상식</a>에도 나오다시피 bump-the-pointer라는 기술을 써서 저렇게 중간에 메모리를 할당하는 일은 없다.  </p>
<img src="/2019/05/07/jvm-gc-basic/eden-space-04.png" class title="아니면 GC 이후에 메모리 Compaction을 수행해야하기 때문에 오버헤드가 발생할 수 밖에 없다.">  


<h3 id="Survivor-Space"><a href="#Survivor-Space" class="headerlink" title="Survivor Space"></a>Survivor Space</h3><p>위에서 언급한 Eden 영역에서 GC로 인해 생기는 오버헤드를 줄이고자 생긴 영역이다.<br>이 영역 또한 Young Generaion의 일부이다.<br>Survivor 영역은 동일한 사이즈의 두 개의 영역으로 구분되는데 각각의 이름은 from과 to이다.<br>(VisualVM 같은 모니터링 툴에는 S0, S1으로 표시되곤 한다.)</p>
<img src="/2019/05/07/jvm-gc-basic/survivor-space-01.png" class title="Eden 영역에서 생존한 객체들이 Survivor 영역의 연속된 메모리 공간으로 넘어오게 되고">
<img src="/2019/05/07/jvm-gc-basic/survivor-space-02.png" class title="Eden 영역은 싹 비우게 됨으로써 Eden 영역의 제일 처음부터 할당하면 되므로 Eden 영역의 메모리 단편화 문제를 해결했다.">  

<p>또한 -XX:SurvivorRatio 속성을 통해 Eden Space 사이즈와 Survivor Generation 사이즈의 비율을 정할 수 있다.<br>예를 들어 -XX:SurvivorRatio&#x3D;6으로 지정하면 1:6&#x3D;Survivor:Eden 라고 보면 된다.<br>(Suivovr는 Young Generation의 1&#x2F;7를 먹고, Eden은 Young Generation의 6&#x2F;7를 먹게 되는 것이다.)<br>즉, 두 Survivor 영역의 합보다 Eden 영역의 메모리가 더 크다.<br>(생존해서 Survivor 영역에 존재하는 객체보다 새롭게 생성돼서 Eden 영역에 할당되는 객체가 훨씬 많으므로…)</p>
<blockquote>
<p>You can use the parameter SurvivorRatio can be used to tune the size of the survivor spaces, but this is often not important for performance.<br>  <a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning/sizing.html">https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning/sizing.html</a></p>
</blockquote>
<p>퍼포먼스에 영향을 주는 경우는 드물다고 적혀있지 않으니 굳이 쓸 필요는 없을 것 같다.</p>
<h4 id="Survivor-Space는-왜-2개일까"><a href="#Survivor-Space는-왜-2개일까" class="headerlink" title="Survivor Space는 왜 2개일까?"></a>Survivor Space는 왜 2개일까?</h4><img src="/2019/05/07/jvm-gc-basic/survivor-space-03.png" class title="그 이유는 Minor GC의 대상이 Eden에만 국한되는 게 아니라 Survivor 영역까지 Minor GC를 하기 때문이다.">  
<img src="/2019/05/07/jvm-gc-basic/survivor-space-04.png" class title="Survivor 영역을 Minor GC를 수행하면 어떻게 될까? Eden 영역만 존재할 때와 마찬가지로 Survivor 영역에도 메모리 단편화가 존재하게 된다.">  

<p><a href="#%EC%95%8C%EC%95%84%EB%91%90%EB%A9%B4-%EC%A2%8B%EC%9D%84-%EC%83%81%EC%8B%9D">알아두면 좋을 상식</a>에도 나오다시피 bump-the-pointer라는 기술을 써서 중간에 빈 공간이 있더라도 해당 공간에 할당하지 않는다.<br>그럼 Survivor Space의 단편화를 없애려면 어떻게 하면 될까?  </p>
<img src="/2019/05/07/jvm-gc-basic/survivor-space-05.png" class title="Eden 영역에서 Survivor 영역을 만든 것과 같이 새로운 영역을 추가하면 된다!">  
<p>따라서 새롭게 영역을 추가하다보니 Survivor Space가 두 개가 된 거다.</p>
<h3 id="Minor-GC"><a href="#Minor-GC" class="headerlink" title="Minor GC"></a>Minor GC</h3><p>그럼 이제 Young Generation에서 일어나는 Minor GC에 대해서 알아보자.<br>(물론 JVM 플래그를 어떻게 주느냐에 따라서 Minor GC의 알고리듬이 달라질 수 있고, 여기서 설명하는 Minor GC의 알고리듬은 아주 간단하고 기본적인 수준에서 설명하고 있다.)</p>
<img src="/2019/05/07/jvm-gc-basic/minor-gc-01.png" class title="새롭게 생성된 객체는 전부 Eden Space에 할당된다. 이 때 객체의 generational count는 0이다.">
<img src="/2019/05/07/jvm-gc-basic/minor-gc-02.png" class title="새롭게 생성된 객체를 또 할당하려는데 Eden Space에 할당할 공간이 없으면 Minor GC를 수행하게 된다. 이제부터 Stop the World의 시작이다.">
<img src="/2019/05/07/jvm-gc-basic/minor-gc-03.png" class title="Eden 영역에 할당된 객체를 순회하면서 GC 루트로부터 접근 가능한 객체만 mark를 한다.">
<img src="/2019/05/07/jvm-gc-basic/minor-gc-04.png" class title="생존한 모든 객체(mark 당한 객체)는 Survivor Space로 복사한다.">
<img src="/2019/05/07/jvm-gc-basic/minor-gc-05.png" class title="GC로부터 살아남은 객체는 이제 generational count가 1로 증가한다. (이렇게 generational count를 1씩 늘리는 프로세스를 aging이라고 부른다... 나이를 먹어가는 ㅠㅠ)">
<img src="/2019/05/07/jvm-gc-basic/minor-gc-06.png" class title="Eden Space를 비운다. (Sweep) 이제 Stop the World가 끝났다.">  
<img src="/2019/05/07/jvm-gc-basic/minor-gc-07.png" class title="이제 Eden Space의 공간 확보가 됐으니 새롭게 생성된 객체를 Eden Space에 할당한다.">
<img src="/2019/05/07/jvm-gc-basic/minor-gc-08.png" class title="새롭게 생성된 객체를 또 할당하려는데 Eden Space에 할당할 공간이 없으면 Minor GC를 수행하게 된다. (Stop the World의 시작)">
<img src="/2019/05/07/jvm-gc-basic/minor-gc-09.png" class title="이번에는 Eden 영역과 더불어 Survivor Space에 할당된 객체를 순회하면서 GC 루트로부터 접근 가능한 객체만 mark를 한다.">  
<img src="/2019/05/07/jvm-gc-basic/minor-gc-10.png" class title="Survivor Space에서 생존하지 못한(mark 당하지 않은) 모든 객체를 수거해간다. (Sweep)">  
<img src="/2019/05/07/jvm-gc-basic/minor-gc-11.png" class title="이 때 Survivor Space에서 생존한 객체는 generational count가 2로 증가한다.">
<img src="/2019/05/07/jvm-gc-basic/minor-gc-12.png" class title="Eden Space에서 mark된(생존한) 객체는 Survivor Space로 복사된다.">
<img src="/2019/05/07/jvm-gc-basic/minor-gc-13.png" class title="이 때 Eden에서 복사되는 객체는 generational count가 1로 증가한다.">
<img src="/2019/05/07/jvm-gc-basic/minor-gc-14.png" class title="이제 Eden Space를 비워준다, Sweep. (Stop the World의 끝)">  
<img src="/2019/05/07/jvm-gc-basic/minor-gc-15.png" class title="이제 새로운 객체를 할당하면 된다.">
<img src="/2019/05/07/jvm-gc-basic/minor-gc-16.png" class title="위 과정들을 반복하다가 또 Eden Space가 꽉 차서 GC를 수행하게 됐다고 가정하자. (Stop the world의 시작)">
<img src="/2019/05/07/jvm-gc-basic/minor-gc-17.png" class title="모든 과정을 마치고 이제 Eden Space에서 생존한 객체들을 Survivor Space로 옮기려고 했더니 Survivor Space에 연속된 메모리 공간을 확보하지 못해서 더 이상 메모리 할당이 불가능하다고 가정해보자.">
<img src="/2019/05/07/jvm-gc-basic/minor-gc-18.png" class title="이 때 From Survivor Space에서 생존한 모든 객체들을 To Survivor Space의 연속된 공간에 먼저 옮기고, 그 후에 Eden Space에서 생존한 객체를 To Survivor Space의 연속된 공간에 옮긴다.">  
<p>To Survivor Space에 Eden Space에 있는 내용보다 From Survivor Space에 있는 내용을 먼저 복사하는 이유는<br>generational count가 적은 객체(Eden Space에 거주중인 객체들)보다 generational count가 높은 객체(From Survivor Space에 거주중인 객체들)의<br>수명이 더 길 가능성이 높기 때문이다. (Weak Generational 가설에 의해…)<br>수명이 더 길 가능성이 높은 메모리를 먼저 배치하는 이유는 메모리의 단편화를 줄이기 위함이다.  </p>
<img src="/2019/05/07/jvm-gc-basic/minor-gc-19.png" class title="생존한 모든 객체를 옮겼으므로 From Survivor Space와 Eden Space를 비운다.">
<img src="/2019/05/07/jvm-gc-basic/minor-gc-20.png" class title="기존 From Survivor Space의 역할을 To Survivor Space가 대신하게 됐으므로 둘의 이름을 바꾼다. (Stop the World의 끝)">
<img src="/2019/05/07/jvm-gc-basic/minor-gc-21.png" class title="GC가 끝났으므로 새로운 객체를 Eden Space에 할당한다.">
<img src="/2019/05/07/jvm-gc-basic/minor-gc-22.png" class title="위 과정을 반복하다가 생존을 반복한 From Survivor Space에 있는 객체가 적당히 나이를 먹었다고 가정해보자.">  
<img src="/2019/05/07/jvm-gc-basic/minor-gc-23.png" class title="그럼 해당 객체는 Promotion(승진)을 한다.">  
<img src="/2019/05/07/jvm-gc-basic/minor-gc-24.png" class title="그러다 다시 Minor GC를 해야되게 됐다.">  
<img src="/2019/05/07/jvm-gc-basic/minor-gc-25.png" class title="이 경우에는 흔치 않게 Old Generation에서 Young Generation을 참조하고 있어서 GC 로직이 복잡해보이는데 간단하게 카드 테이블에 저장된 객체만 추가로 검사해서 Old Generation에서 Young Generation으로 참조 중인 객체를 쉽고 빠르게 찾을 수 있다.">  

<h4 id="Promotion"><a href="#Promotion" class="headerlink" title="Promotion"></a>Promotion</h4><p>아래 나오는 그림에서 동그라미 안의 숫자는 객체의 나이(객체가 GC로부터 살아남은 횟수)를 의미한다.  </p>
<img src="/2019/05/07/jvm-gc-basic/promotion-01.png" class title="Promotion(승진)은 Young Generation에서 적당히 나이를 먹어서(GC로 부터 살아남아서 계속해서 generational count가 늘어나서 적당한 generational count가 됐음을 의미)">
<img src="/2019/05/07/jvm-gc-basic/promotion-02.png" class title="이제 Old Generation으로 갈 나이가 됐으니 Old Generation으로 이동하는 걸 의미한다.">
<p>generational count가 어느정도 있으려면<del>(짬밥을 어느정도 먹었으려면)</del> 당연히 Survivor Space에 있는 객체가 이동됨을 의미한다.</p>
<p>적당한 나이는 -XX:InitialTenuringThreshold와 -XX:MaxTenuringThreshold 파라미터로 정할 수 있다.<br>(Old 영역으로 승진하는 객체의 갯수나 비율이 많아지면 자동으로 TenuringThreshold를 늘리는 원리인지 뭔지 잘 모르겠다…)    </p>
<h4 id="Premature-Promotion"><a href="#Premature-Promotion" class="headerlink" title="Premature Promotion"></a>Premature Promotion</h4><p>적당한 나이(TenuringThreshold)를 먹지 않았는데 어쩔 수 없이 Old Generation으로 이동하는 행위를 premature promotion(조기 승진)이라고 부른다.<br>아래 나오는 그림에서 동그라미 안의 숫자는 객체의 나이(객체가 GC로부터 살아남은 횟수)를 의미한다.  </p>
<img src="/2019/05/07/jvm-gc-basic/premature-promotion-01.png" class title="주로 메모리 할당이 잦다보니 Survivor Space에 적당한 공간이 없어서">  
<img src="/2019/05/07/jvm-gc-basic/premature-promotion-02.png" class title="나이를 먹지 않았음에도 Old Generation으로 옮겨지는 경우도 Premature Promotion이고,">  
<img src="/2019/05/07/jvm-gc-basic/premature-promotion-03.png" class title="새롭게 할당될 객체의 용량이 Eden Space의 용량보다 큰 경우에는">  
<img src="/2019/05/07/jvm-gc-basic/premature-promotion-04.png" class title="바로 Old Generation에 할당되게 되는데 이 경우에도 Premature Promotion이고,">
<img src="/2019/05/07/jvm-gc-basic/premature-promotion-04.png" class title="원래 같으면 Eden Space의 내용이 From Survivor Space 영역의 바로 아래 공간에 할당되면 되는데, -XX:TargetSurvivorRatio(기본값 50)에 의해 할당되지 못하는 경우가 있다.">  
<p>-XX:TargetSurvivorRatio는 Minor GC 이후의 From Survivor Space의 사용률(%)을 제한하는 옵션이다.  </p>
<img src="/2019/05/07/jvm-gc-basic/premature-promotion-06.png" class title="적당한 나이가 되지 않은 어린 객체가 Old Generation으로 이동하는 것도 Premature Promotion이다.">

<p>이 premature promotion의 경우에는 Old Generation에 놓기 때문에 Major GC 혹은 Full GC가 일어나기 전에는 회수해가지 않으며<br>적당한 나이를 먹지 않고 와서 단명할 가능성이 높음에도 불구하고 쓸데없이 Old Generation을 차지하고 있기 때문에<br>Major GC 혹은 Full GC의 발생 빈도를 늘려 어플리케이션 전반에 영향을 미치기 때문에 적절하게 Young Generation과 관련된 사이즈를 정하는 게 중요하다.</p>
<h2 id="Old-Generation"><a href="#Old-Generation" class="headerlink" title="Old Generation"></a>Old Generation</h2><p>객체가 적당한 나이를 먹거나 조기 승진을 통해 넘어온 객체들이 존재하는 영역이다.<br>Tenure Generation이라고도 부른다.<br>해당 영역에 존재하는 객체들을 Young Generation에 있는 객체들보다 회수당할 가능성이 적다는 게 Weak Generational 가설이다.<br>또한 대부분의 객체가 Young Generation에서 사망하시기 때문에 Old Generation으로 오는 객체는 Young Generation에 할당되는 객체의 비율에 비해 현저히 낮다.</p>
<h3 id="Major-GC"><a href="#Major-GC" class="headerlink" title="Major GC"></a>Major GC</h3><p>Major GC 역시 Old Generation이 꽉 찼을 때 수행된다.<br>기본적으로 Old Generation은 메모리 할당률이 낮기 때문에 GC가 일어나는 빈도가 적다.<br>또한 대부분 Old Generation은 Young Generation 보다 용량을 크게 잡기 때문에 객체의 갯수도 많아서 GC 시간이 길다.<br>GC의 시간이 길다는 것은 그만큼 Stop the World, 어플리케이션이 멈추는 시간도 길다는 의미고 그런 의미에서 Major GC(주요한 GC)라고 이름을 붙인 게 아닐까 싶다.<br>또한 Old Generation은 Young Generation과 같이 Survivor Space가 존재하는 게 아니기 때문에 메모리 단편화도 신경써야하고 관리해야할 객체도 많다보니 훨씬 알고리듬이 복잡해진다.<br>이에 대해선 다음에 글을 써볼 예정이다.</p>
<h2 id="Full-GC"><a href="#Full-GC" class="headerlink" title="Full GC"></a>Full GC</h2><p>Minor GC + Major GC를 Full GC라고 부른다.<br>정확히 언제 일어나는지 모르겠지만 Old Generation GC에 대해 좀 더 자세히 공부하고 다시 작성해야겠다.</p>
<h2 id="Permanent-Generation"><a href="#Permanent-Generation" class="headerlink" title="Permanent Generation"></a>Permanent Generation</h2><p>JVM의 Method Area를 Hotspot VM에서 Permanent Generation(줄여서 PermGen)으로 부르기 시작하면서 다른 VM에서도 PermGen이라고 부르는 것 같다.<br>PermGen은 자바 8에서 사라졌다.<br>PermGen에는 클래스의 메타데이터, 메서드의 메타데이터, 상수풀, static 변수 등등이 들어간다.<br>PermGen은 이름만 들어보면 Permanent(영구적인)가 들어가다보니 영구히 존재하는 데이터들만 저장될 거 같은데 필수는 아니지만 GC가 수행되기도 한다.<br>GC가 수행된다는 관점에서인지 이 영역을 힙 메모리로 보는 사람도 있는데 나는 클래스의 인스턴스가 저장되는 것도 아니고<br>-Xmx, -Xms와는 별개로 사이즈가 지정되다보니 힙메모리가 아니라고 생각하고 있다.<br>-XX:PermSize와 -XX:MaxPermSize로 사이즈를 지정할 수 있고, GC를 수행하지 않는다면 용량이 부족해질 수 있고 아래와 같은 OOME가 난다.<br><code>java.lang.OutOfMemoryError: PermGen space</code><br>이러한 에러가 나는 이유는 여러가지가 있는데 대표적으로 다음과 같다.</p>
<ul>
<li>collection을 static으로 만들고 계속해서 요소를 추가하는 경우(이런 실수를 범하면 절대 안된다.)</li>
<li>서버를 재시작하지 않고 변경 내역을 바로바로 반영해주는 HotDeploy를 계속해서 사용하다보면 Class와 Method의 메타데이터가 계속해서 쌓이게 되는데<br>서버를 주기적으로 재시작해주지 않고, 계속해서 HotDeploy 하는 경우(실서버에서 이런 경우는 거의 없을 것이다.)</li>
</ul>
<h2 id="Metadata"><a href="#Metadata" class="headerlink" title="Metadata"></a>Metadata</h2><p>자바 8부터 PermGen의 역할을 Metadata 영역에서 맡기 시작했고 Native 영역으로 옮겨졌다. (즉 OS에서 관리한다는 의미)<br>PermGen 중에 일부만 Metadata 영역에서 맡기 시작했고, 상수풀이나 static 변수는 Heap 메모리로 옮겨져왔다.<br>즉, 개발자가 실수하기 쉽거나 변경이 잦은 내용들은 힙 메모리로 끌고와서 GC의 대상이 되게 하고, 정말 변경이 될 가능성이 적은 내용들만 Native 영역으로 옮겨버렸다.<br>문제는 Native 영역은 dump를 떠도 안 나와서 분석하기 힘들다는데 이럴 일은 아마 거의 없을 것이다…<br>Metadata에 대한 관리는 OS에서 함으로 믿고 맡겨도 된다고 생각하지만(개발자가 직접하는 것보다 낫지 않을까?),<br>혹시 이 쪽을 튜닝해야하거나 OOME(java.lang.OutOfMemoryError: Metadata space)가 발생한 경우에는 -XX:MetaspaceSize와 -XX:MaxMetaspaceSize 파라미터를 사용해보자.</p>
<h2 id="OutOfMemoryException"><a href="#OutOfMemoryException" class="headerlink" title="OutOfMemoryException"></a>OutOfMemoryException</h2><p>주로 OOME라고 줄여부르며 메모리 공간이 부족해서 나는 예외로 어플리케이션 자체가 뻗는 현상이 발생한다.<br>이 예외가 발생했을 때는 메모리 릭(메모리 결함)이 발생한 경우이고 Heap 메모리나 PermGen(Metaspace) 등등의 영역이 부족할 때 발생하는데<br>어떤 메모리가 부족한 건지, 아니면 왜 이 오류가 났는지 Stacktrace를 찍고 사망한다.</p>
<p>여기서는 힙 메모리가 부족해서 OOME가 발생한 경우의 원인에 대해서만 설명하겠다.<br>우선 메모리가 부족하면 가비지 컬렉터는 힙메모리의 가비지 컬렉션을 수행한다.<br>가비지 컬렉션을 수행했음에도 불구하고 새로운 객체를 더이상 할당할 수 없는 경우에 OOME가 발생하게 된다.<br>이 때는 아주 급한 경우에는 일단 -Xmx와 -Xms로 메모리를 늘리고 보고,</p>
<img src="/2019/05/07/jvm-gc-basic/mat.png" class>  
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-XX:+HeapDumpOnOutOfMemoryError </span><br><span class="line">-XX:HeapDumpPath=<span class="variable">$&#123;PATH&#125;</span>/<span class="variable">$&#123;FILE_NAME&#125;</span>.hprof</span><br></pre></td></tr></table></figure>
<p>위 두가지 설정을 주고 실행해서 재발하면 힙덤프를 생성하거나 아니면<br>jmap 등등으로 살아있는 서버의 힙덤프를 떠서 어디서 메모리 릭이 발생했는지 Eclipse MAT 등등으로 분석하거나</p>
<img src="/2019/05/07/jvm-gc-basic/visual-vm.png" class>  
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-Dcom.sun.management.jmxremote</span><br><span class="line">-Dcom.sun.management.jmxremote.port=<span class="variable">$&#123;JMX_PORT&#125;</span></span><br><span class="line">-Dcom.sun.management.jmxremote.authenticate=<span class="literal">false</span></span><br><span class="line">-Dcom.sun.management.jmxremote.ssl=<span class="literal">false</span></span><br><span class="line">-Dcom.sun.management.jmxremote.rmi.port=<span class="variable">$&#123;RMI_PORT&#125;</span></span><br><span class="line">-Djava.rmi.server.hostname=<span class="variable">$&#123;HOST_NAME&#125;</span></span><br></pre></td></tr></table></figure>
<p>위 설정 등등을 줘서 VisualVM으로 서버에 실제로 떠있는 어플리케이션 등등을 모니터링하는 방법이 있다.</p>
<h2 id="알아두면-좋을-상식"><a href="#알아두면-좋을-상식" class="headerlink" title="알아두면 좋을 상식"></a>알아두면 좋을 상식</h2><ul>
<li>Hotspot VM의 GC는 Arena라는 메모리 영역에서 작동한다.</li>
<li>Hotspot VM은 시작 시 메모리를 유저 공간에 할당&#x2F;관리한다.<br>따라서 힙 메모리를 관리할 때 시스템 콜을 하지 않으므로 커널 공간으로 컨텍스트 스위칭을 하지 않아서 성능 향상에 도움이 된다.</li>
<li>Hotspot VM은 할당된 메모리 가장 마지막의 다음 영역을 가리켜 연속된 빈 공간에 효율적으로 빠르게 할당하는 bump-the-pointer라는 기술을 사용했다.</li>
<li>Hotspot VM은 멀티 스레드 환경에서 객체를 할당할 때 스레드 간의 경합 등등의 문제를 줄이고자 TLAB(Thread Local Allocation Buffer)를 사용했다.<br>Eden Space를 여러 버퍼로 나누어 각 어플리케이션 스레드에게 할당함으로써 자기 자신이 사용해야 할 버퍼를 바로 찾게되고, 리소스를 공유해서 생기는 문제를 없애버렸다.<br>만약 본인에게 할당된 TLAB가 부족할 경우에는 크기를 동적으로 조정한다.</li>
</ul>
<h2 id="마치며"><a href="#마치며" class="headerlink" title="마치며"></a>마치며</h2><p>해당 글을 읽고 <a href="/2019/05/11/jvm-gc-advanced/">Garbage Collection Advanced</a> 편을 읽어보시면 GC에 대해 더 깊게 이해하실 수 있을 겁니다 :)</p>
<h2 id="참조-링크"><a href="#참조-링크" class="headerlink" title="참조 링크"></a>참조 링크</h2><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://d2.naver.com/helloworld/1329">Naver D2 - Java Garbage Collection</a>  </li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://d2.naver.com/helloworld/1230">Naver D2 - JVM Internal</a>  </li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.youtube.com/watch?v=DoJr5QQYsl8">The JVM and Java Garbage Collection - OLL Live (Recorded Webcast Event)</a>  </li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://starplatina.tistory.com/entry/JDK8%EC%97%90%EC%84%A0-PermGen%EC%9D%B4-%EC%99%84%EC%A0%84%ED%9E%88-%EC%82%AC%EB%9D%BC%EC%A7%80%EA%B3%A0-Metaspace%EA%B0%80-%EC%9D%B4%EB%A5%BC-%EB%8C%80%EC%8B%A0-%ED%95%A8">JDK8에선 PermGen이 완전히 사라지고 Metaspace가 이를 대신 함.</a>  </li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://brunch.co.kr/@heracul/1">JDK8 적용 후, 심각한 성능저하가 발생한다면?</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://yckwon2nd.blogspot.com/2015/03/java8-permanent.html">JAVA8 Permanent 영역은 어디로 가는가</a>  </li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/memleaks002.html">Understand the OutOfMemoryError Exception - Oracle Docs</a>  </li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning/sizing.html">Sizing the Generations - Oracle Docs</a>  </li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://plumbr.io/blog/garbage-collection/minor-gc-vs-major-gc-vs-full-gc">Minor GC vs Major GC vs Full GC</a>  </li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://blog.codecentric.de/en/2012/08/useful-jvm-flags-part-5-young-generation-garbage-collection/">Useful JVM Flags – Part 5 (Young Generation Garbage Collection)</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://www.herongyang.com/Java-GC/Serial-TargetSurvivorRatio-Second-Tenuring-Condition.html">“-XX:TargetSurvivorRatio” - Second Tenuring Condition</a></li>
</ul>
<p>그 외 더 많은 거 같은데 기억이 잘 나지 않는다…</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Java/" rel="tag"># Java</a>
              <a href="/tags/JVM/" rel="tag"># JVM</a>
              <a href="/tags/GC/" rel="tag"># GC</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2019/05/05/jmx-monitoring-inside-docker-container-over-ssh-tunneling/" rel="prev" title="(삽질기) SSH 터널링을 통해 원격지에 존재하는 도커 컨테이너 안의 JMX 모니터링하기">
                  <i class="fa fa-chevron-left"></i> (삽질기) SSH 터널링을 통해 원격지에 존재하는 도커 컨테이너 안의 JMX 모니터링하기
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2019/05/11/jvm-gc-advanced/" rel="next" title="(JVM) Garbage Collection Advanced">
                  (JVM) Garbage Collection Advanced <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2016 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">양권성</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="external nofollow noopener noreferrer" target="_blank">NexT.Pisces</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>



  <script src="/js/third-party/fancybox.js"></script>


  




<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"exobud","count":true,"i18n":{"disqus":"disqus"}}</script>
<script src="/js/third-party/comments/disqus.js"></script>

</body>
</html>
