<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon/favicon-16x16.png">
  <link rel="mask-icon" href="/images/favicon/safari-pinned-tab.svg" color="#222">
  <link rel="manifest" href="/images/favicon/manifest.json">
  <meta name="google-site-verification" content="yL1R2eDsKDqjPNaOBKp1usSDw8SQNzaO35svs1LKYWw">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"perfectacle.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":true,"version":"8.12.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":false,"color":"#222","save":"manual"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"disqus","storage":true,"lazyload":false,"nav":null,"activeClass":"disqus"},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":true}}</script><script src="/js/config.js"></script>

    <meta name="description" content="JUnt 4Field Injection 밖에 되지 않음.Spring Boot 2.2.0부터 JUnit 5가 기본으로 탑재되기 시작했고,Spring Boot 2.4.0부터는 아예 JUnit 4 의존성이 제거됐기 때문에 JUnit 4의 사용은 하지 말아야한다. 12345678@RunWith(SpringRunner::class)@SpringBootTestclas">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring Boot + JUnit에서 의존성 주입하기">
<meta property="og:url" content="https://perfectacle.github.io/2020/12/25/dependency-injection-in-junit/index.html">
<meta property="og:site_name" content="오늘도 끄적끄적">
<meta property="og:description" content="JUnt 4Field Injection 밖에 되지 않음.Spring Boot 2.2.0부터 JUnit 5가 기본으로 탑재되기 시작했고,Spring Boot 2.4.0부터는 아예 JUnit 4 의존성이 제거됐기 때문에 JUnit 4의 사용은 하지 말아야한다. 12345678@RunWith(SpringRunner::class)@SpringBootTestclas">
<meta property="og:locale" content="ko_KR">
<meta property="article:published_time" content="2020-12-25T02:55:29.000Z">
<meta property="article:modified_time" content="2022-06-06T08:23:56.004Z">
<meta property="article:author" content="양권성">
<meta property="article:tag" content="Spring">
<meta property="article:tag" content="Spring Boot">
<meta property="article:tag" content="JUnit">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://perfectacle.github.io/2020/12/25/dependency-injection-in-junit/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"ko","comments":true,"permalink":"https://perfectacle.github.io/2020/12/25/dependency-injection-in-junit/","path":"2020/12/25/dependency-injection-in-junit/","title":"Spring Boot + JUnit에서 의존성 주입하기"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Spring Boot + JUnit에서 의존성 주입하기 | 오늘도 끄적끄적</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-87795455-1"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-87795455-1","only_pageview":false}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>




<!--<script data-ad-client="ca-pub-3881550906962162" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>-->
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="오늘도 끄적끄적" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">오늘도 끄적끄적</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">느리더라도 꾸준하게</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>홈</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>정보</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>태그<span class="badge">254</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>카테고리<span class="badge">49</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>아카이브<span class="badge">216</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>검색
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          목차
        </li>
        <li class="sidebar-nav-overview">
          흝어보기
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#JUnt-4"><span class="nav-number">1.</span> <span class="nav-text">JUnt 4</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JUnit-5"><span class="nav-number">2.</span> <span class="nav-text">JUnit 5</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring-Boot-2-0-x-Spring-5-0-x"><span class="nav-number">2.1.</span> <span class="nav-text">Spring Boot 2.0.x (Spring 5.0.x)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring-Boot-2-1-x-Spring-5-1-x"><span class="nav-number">2.2.</span> <span class="nav-text">Spring Boot 2.1.x (Spring 5.1.x)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring-Boot-2-2-x-Spring-5-2x"><span class="nav-number">2.3.</span> <span class="nav-text">Spring Boot 2.2.x (Spring 5.2x)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#TestConstructor-%EC%96%B4%EB%85%B8%ED%85%8C%EC%9D%B4%EC%85%98%EC%9D%84-%ED%86%B5%ED%95%9C-Autowired-%EC%96%B4%EB%85%B8%ED%85%8C%EC%9D%B4%EC%85%98-%EC%83%9D%EB%9E%B5"><span class="nav-number">2.3.1.</span> <span class="nav-text">@TestConstructor 어노테이션을 통한 @Autowired 어노테이션 생략</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#spring-properties-%ED%8C%8C%EC%9D%BC%EC%9D%84-%ED%86%B5%ED%95%9C-Autowired-%EC%96%B4%EB%85%B8%ED%85%8C%EC%9D%B4%EC%85%98-%EC%83%9D%EB%9E%B5"><span class="nav-number">2.3.2.</span> <span class="nav-text">spring.properties 파일을 통한 @Autowired 어노테이션 생략</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring-Boot-2-3-x-Spring-5-2-x"><span class="nav-number">2.4.</span> <span class="nav-text">Spring Boot 2.3.x (Spring 5.2.x)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring-Boot-2-4-x-Spring-5-3-2"><span class="nav-number">2.5.</span> <span class="nav-text">Spring Boot 2.4.x (Spring 5.3.2)</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="양권성" src="/images/avatar/avatar.png">
  <p class="site-author-name" itemprop="name">양권성</p>
  <div class="site-description" itemprop="description">Toss Server Developer</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">216</span>
          <span class="site-state-item-name">포스트</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">49</span>
        <span class="site-state-item-name">카테고리</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">254</span>
        <span class="site-state-item-name">태그</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/perfectacle" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;perfectacle" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:perfectacle@gmail.com" title="E-Mail → mailto:perfectacle@gmail.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.facebook.com/perfectacle" title="FB Page → https:&#x2F;&#x2F;www.facebook.com&#x2F;perfectacle" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-facebook fa-fw"></i></a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="ko">
    <link itemprop="mainEntityOfPage" href="https://perfectacle.github.io/2020/12/25/dependency-injection-in-junit/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar/avatar.png">
      <meta itemprop="name" content="양권성">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="오늘도 끄적끄적">
      <meta itemprop="description" content="Toss Server Developer">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Spring Boot + JUnit에서 의존성 주입하기 | 오늘도 끄적끄적">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Spring Boot + JUnit에서 의존성 주입하기
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">작성일</span>

      <time title="Post created: 2020-12-25 02:55:29" itemprop="dateCreated datePublished" datetime="2020-12-25T02:55:29+00:00">2020-12-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Updated at: 2022-06-06 08:23:56" itemprop="dateModified" datetime="2022-06-06T08:23:56+00:00">2022-06-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2020/12/25/dependency-injection-in-junit/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/12/25/dependency-injection-in-junit/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="JUnt-4"><a href="#JUnt-4" class="headerlink" title="JUnt 4"></a>JUnt 4</h2><p>Field Injection 밖에 되지 않음.<br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.2-Release-Notes#junit-5">Spring Boot 2.2.0</a>부터 JUnit 5가 기본으로 탑재되기 시작했고,<br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.4-Release-Notes#junit-5s-vintage-engine-removed-from-spring-boot-starter-test">Spring Boot 2.4.0</a>부터는 아예 JUnit 4 의존성이 제거됐기 때문에 <code>JUnit 4의 사용은 하지 말아야한다.</code></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner::class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> a: SomeComponent</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">contextLoad</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="JUnit-5"><a href="#JUnit-5" class="headerlink" title="JUnit 5"></a>JUnit 5</h2><p>JUnit 5의 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://junit.org/junit5/docs/5.1.1/api/org/junit/jupiter/api/extension/ExtendWith.html">@ExtendedWith</a> 어노테이션을 이용하면 테스트 전&#x2F;후로 다양한 일을 할 수 있다.<br>@ExtendedWith 어노테이션은 어노테이션에 명시한 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://junit.org/junit5/docs/5.1.1/api/org/junit/jupiter/api/extension/Extension.html">Extension</a>들을 실행하는 역할 뿐이 하지 않는다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repeatable(Extensions.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> ExtendWith &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * An array of one or more &#123;<span class="doctag">@link</span> Extension&#125; classes to register.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">Extension</span>&gt;[] value()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://junit.org/junit5/docs/5.1.1/api/org/junit/jupiter/api/extension/AfterEachCallback.html">AfterEachCallback</a>과 같은 다양한 Extension 인터페이스들을 직접 개발자가 구현하고 본인이 원하는 Extension만 넣으면 되는 구조다.<br>이렇게 함으로써 전&#x2F;후 처리 해야되는 내용들은 Extnsion을 통해 직접 구현하고 @ExtendedWith에 기술함으로써 개발자가 좀 더 테스트에 집중할 수 있게 만들어준다.</p>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/spring-projects/spring-boot/blob/2.0.x/spring-boot-project/spring-boot-test/src/main/java/org/springframework/boot/test/context/SpringBootTest.java#L75">@SpringBootTest</a>처럼 어플리케이션 컨텍스트를 로딩해야하는 테스트를 작성할 때 컨텍스트 로딩하는 코드를 직접 테스트 코드에 삽입하지 않고,<br>여러 Extension을 구현한 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/spring-projects/spring-framework/blob/master/spring-test/src/main/java/org/springframework/test/context/junit/jupiter/SpringExtension.java#L78">SpringExtension</a>을 사용하여 문제를 해결할 수 있다.<br>또한 SpringExtension을 사용하면 Constructor Injection도 지원하는데 SpringExtension이 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://junit.org/junit5/docs/5.1.1/api/org/junit/jupiter/api/extension/ParameterResolver.html">ParameterResolver</a> Extension을 구현했기 때문이다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringExtension</span> <span class="keyword">implements</span> <span class="title class_">BeforeAllCallback</span>, AfterAllCallback, TestInstancePostProcessor,</span><br><span class="line">    BeforeEachCallback, AfterEachCallback, BeforeTestExecutionCallback, AfterTestExecutionCallback,</span><br><span class="line">       ParameterResolver &#123;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ParameterResolver defines the API for Extensions that wish to dynamically resolve arguments for parameters at runtime.<br>  If a constructor for a test class or a @Test, @BeforeEach, @AfterEach, @BeforeAll, or @AfterAll method declares a parameter, an argument for the parameter must be resolved at runtime by a ParameterResolver.</p>
</blockquote>
<p>ParameterResolver는 두 개의 API를 가지고 있는데 해당 파라미터의 리졸빙을 지원하는지를 판단하는 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://junit.org/junit5/docs/5.1.1/api/org/junit/jupiter/api/extension/ParameterResolver.html#supportsParameter-org.junit.jupiter.api.extension.ParameterContext-org.junit.jupiter.api.extension.ExtensionContext-">supportsParameter</a> 메서드와 실제 리졸빙을 하는 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://junit.org/junit5/docs/5.1.1/api/org/junit/jupiter/api/extension/ParameterResolver.html#resolveParameter-org.junit.jupiter.api.extension.ParameterContext-org.junit.jupiter.api.extension.ExtensionContext-">resolveParameter</a> 메서드가 있다.</p>
<h3 id="Spring-Boot-2-0-x-Spring-5-0-x"><a href="#Spring-Boot-2-0-x-Spring-5-0-x" class="headerlink" title="Spring Boot 2.0.x (Spring 5.0.x)"></a>Spring Boot 2.0.x (Spring 5.0.x)</h3><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/spring-projects/spring-boot/blob/2.0.x/spring-boot-project/spring-boot-dependencies/pom.xml#L156">Spring Boot 2.0.x는 Spring 5.0.x를 사용</a>하기 때문에 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/spring-projects/spring-framework/blob/5.0.x/spring-test/src/main/java/org/springframework/test/context/junit/jupiter/SpringExtension.java#L60">Spring Test 5.0.x의 SpringExtension 클래스</a>를 보면 당연히 ParameterResolver Extension을 구현하였다.<br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/spring-projects/spring-framework/blob/5.0.x/spring-test/src/main/java/org/springframework/test/context/junit/jupiter/SpringExtension.java#L161">supportsParameter 메서드 로직 중에 @Autowired 어노테이션이 포함돼있는지를 판단</a>하여 지원 여부를 구분하고</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supportsParameter</span><span class="params">(ParameterContext parameterContext, ExtensionContext extensionContext)</span> &#123;</span><br><span class="line">    <span class="type">Parameter</span> <span class="variable">parameter</span> <span class="operator">=</span> parameterContext.getParameter();</span><br><span class="line">    <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> parameterContext.getIndex();</span><br><span class="line">    <span class="type">Executable</span> <span class="variable">executable</span> <span class="operator">=</span> parameter.getDeclaringExecutable();</span><br><span class="line">    <span class="keyword">return</span> (executable <span class="keyword">instanceof</span> Constructor &amp;&amp;</span><br><span class="line">        AnnotatedElementUtils.hasAnnotation(executable, Autowired.class)) ||</span><br><span class="line">        ParameterAutowireUtils.isAutowirable(parameter, index);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/spring-projects/spring-framework/blob/5.0.x/spring-test/src/main/java/org/springframework/test/context/junit/jupiter/SpringExtension.java#L179">resolveParameter 메서드에서는 ParameterAutowireUtils.resolveDependency 메서드를 호출</a>하여 실제 리졸빙을 수행하고 있다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">resolveParameter</span><span class="params">(ParameterContext parameterContext, ExtensionContext extensionContext)</span> &#123;</span><br><span class="line">    <span class="type">Parameter</span> <span class="variable">parameter</span> <span class="operator">=</span> parameterContext.getParameter();</span><br><span class="line">    <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> parameterContext.getIndex();</span><br><span class="line">    Class&lt;?&gt; testClass = extensionContext.getRequiredTestClass();</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> getApplicationContext(extensionContext);</span><br><span class="line">    <span class="keyword">return</span> ParameterAutowireUtils.resolveDependency(parameter, index, testClass, applicationContext);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>그리고 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/spring-projects/spring-boot/blob/2.0.x/spring-boot-project/spring-boot-test/src/main/java/org/springframework/boot/test/context/SpringBootTest.java#L75">Spring Boot Test 2.0.x에서는 @SpringBootTest 어노테이션</a>에 @ExtendedWith(SpringExtension.class)가 포함돼있지 않다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@BootstrapWith(SpringBootTestContextBootstrapper.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SpringBootTest &#123;</span><br></pre></td></tr></table></figure>

<p>따라서 @ExtendedWith(SpringExtension.class)를 무조건 명시해주어야 어플리케이션 컨텍스트가 정상적으로 로딩된다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExtendedWith(SpringExtension::class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SomeTest</span>(</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> val a: SomeComponent</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    fun <span class="title function_">contextLoad</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Spring-Boot-2-1-x-Spring-5-1-x"><a href="#Spring-Boot-2-1-x-Spring-5-1-x" class="headerlink" title="Spring Boot 2.1.x (Spring 5.1.x)"></a>Spring Boot 2.1.x (Spring 5.1.x)</h3><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/spring-projects/spring-boot/blob/2.1.x/spring-boot-project/spring-boot-dependencies/pom.xml#L168">Spring Boot 2.1.x는 Spring 5.1.x를 사용</a>하기 때문에 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/spring-projects/spring-framework/blob/5.1.x/spring-test/src/main/java/org/springframework/test/context/junit/jupiter/SpringExtension.java#L161">Spring Test 5.1.x의 SpringExtension 클래스의 supportsParameter 메서드를 보면 Autowired 어노테이션이 있는지 비교하는 부분</a>은 똑같아서 큰 변화가 없다.<br>하지만 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/spring-projects/spring-boot/blob/2.1.x/spring-boot-project/spring-boot-test/src/main/java/org/springframework/boot/test/context/SpringBootTest.java#L78">Spring Boot Test 2.1.x에서는 @SpringBootTest 어노테이션에 @ExtendedWith(SpringExtension.class)가 포함</a>됐다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@BootstrapWith(SpringBootTestContextBootstrapper.class)</span></span><br><span class="line"><span class="meta">@ExtendWith(SpringExtension.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SpringBootTest &#123;</span><br></pre></td></tr></table></figure>

<p>이는 어플리케이션 컨텍스트를 로딩하는 다른 테스트 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/spring-projects/spring-boot/blob/2.1.x/spring-boot-project/spring-boot-test-autoconfigure/src/main/java/org/springframework/boot/test/autoconfigure/web/servlet/WebMvcTest.java#L80">@WebMvcTest</a>, <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/spring-projects/spring-boot/blob/2.1.x/spring-boot-project/spring-boot-test-autoconfigure/src/main/java/org/springframework/boot/test/autoconfigure/orm/jpa/DataJpaTest.java#L75">@DataJpaTest</a>, <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/spring-projects/spring-boot/blob/2.1.x/spring-boot-project/spring-boot-test-autoconfigure/src/main/java/org/springframework/boot/test/autoconfigure/json/JsonTest.java#L68">@JsonTest</a> 등등과 같은 Slice Test 류에도 동일하게 적용되었다.<br>따라서 테스트를 작성할 때 @ExtendWith가 생략 가능해졌다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SomeTest</span>(</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> val a: SomeComponent</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    fun <span class="title function_">contextLoad</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Spring-Boot-2-2-x-Spring-5-2x"><a href="#Spring-Boot-2-2-x-Spring-5-2x" class="headerlink" title="Spring Boot 2.2.x (Spring 5.2x)"></a>Spring Boot 2.2.x (Spring 5.2x)</h3><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/spring-projects/spring-boot/blob/2.2.x/spring-boot-project/spring-boot-dependencies/pom.xml#L194">Spring Boot 2.2.x는 Spring 5.2.x</a>를 사용하기 때문에 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/spring-projects/spring-framework/blob/5.2.x/spring-test/src/main/java/org/springframework/test/context/junit/jupiter/SpringExtension.java#L166">Spring Test 5.2.x의 SpringExtension 클래스를 보면 supportsParameter 메서드</a>의 로직이 달라져있다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supportsParameter</span><span class="params">(ParameterContext parameterContext, ExtensionContext extensionContext)</span> &#123;</span><br><span class="line">    <span class="type">Parameter</span> <span class="variable">parameter</span> <span class="operator">=</span> parameterContext.getParameter();</span><br><span class="line">    <span class="type">Executable</span> <span class="variable">executable</span> <span class="operator">=</span> parameter.getDeclaringExecutable();</span><br><span class="line">    Class&lt;?&gt; testClass = extensionContext.getRequiredTestClass();</span><br><span class="line">    <span class="keyword">return</span> (TestConstructorUtils.isAutowirableConstructor(executable, testClass) ||</span><br><span class="line">        ApplicationContext.class.isAssignableFrom(parameter.getType()) ||</span><br><span class="line">        ParameterResolutionDelegate.isAutowirable(parameter, parameterContext.getIndex()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>단순히 @Autowired 어노테이션이 있는지 검사하는 게 아니라 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/spring-projects/spring-framework/blob/5.2.x/spring-test/src/main/java/org/springframework/test/context/support/TestConstructorUtils.java#L60">TestConstructorUtils.isAutowirableConstructor 메서드</a>를 호출하는 것으로 변하였다. 해당 메서드를 계속 추적하다보면 아래 메서드를 만나게 된다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isAutowirableConstructor</span><span class="params">(Constructor&lt;?&gt; constructor, Class&lt;?&gt; testClass)</span> &#123;</span><br><span class="line">    <span class="comment">// Is the constructor annotated with @Autowired?</span></span><br><span class="line">    <span class="keyword">if</span> (AnnotatedElementUtils.hasAnnotation(constructor, Autowired.class)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">AutowireMode</span> <span class="variable">autowireMode</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Is the test class annotated with @TestConstructor?</span></span><br><span class="line">    <span class="type">TestConstructor</span> <span class="variable">testConstructor</span> <span class="operator">=</span> AnnotatedElementUtils.findMergedAnnotation(testClass, TestConstructor.class);</span><br><span class="line">    <span class="keyword">if</span> (testConstructor != <span class="literal">null</span>) &#123;</span><br><span class="line">        autowireMode = testConstructor.autowireMode();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Custom global default?</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> SpringProperties.getProperty(TestConstructor.TEST_CONSTRUCTOR_AUTOWIRE_MODE_PROPERTY_NAME);</span><br><span class="line">        <span class="keyword">if</span> (value != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                autowireMode = AutowireMode.valueOf(value.trim().toUpperCase());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">                <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">                    logger.debug(String.format(<span class="string">&quot;Failed to parse autowire mode &#x27;%s&#x27; for property &#x27;%s&#x27;: %s&quot;</span>, value,</span><br><span class="line">                        TestConstructor.TEST_CONSTRUCTOR_AUTOWIRE_MODE_PROPERTY_NAME, ex.getMessage()));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (autowireMode == AutowireMode.ALL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>@Autowired 어노테이션이 달려있으면 true를 반환한다.</li>
<li>autowireMode 변수를 선언하고, null로 초기화한다.</li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/spring-projects/spring-framework/blob/5.2.x/spring-test/src/main/java/org/springframework/test/context/TestConstructor.java#L66">@TestConstructor 어노테이션</a>이 달려있는지 확인한다.<ol>
<li>달려있으면 해당 어노테이션의 autowireMode 프로퍼티를 autowireMode 변수에 할단한다.</li>
<li>달려있지 않으면 아래 분기를 탄다.<ol>
<li>클래스 패스에 있는 spring.properties 파일에서 spring.test.constructor.autowire.mode 프로퍼티를 가져온다.</li>
<li>프로퍼티를 AutowireMode enum으로 변환해보고 성공하면 autowireMode 변수에 할당한다.</li>
</ol>
</li>
</ol>
</li>
<li>autowireMode 변수가 AutowireMode.ALL과 같으면 true, 다르면 false를 반환한다.</li>
</ol>
<h4 id="TestConstructor-어노테이션을-통한-Autowired-어노테이션-생략"><a href="#TestConstructor-어노테이션을-통한-Autowired-어노테이션-생략" class="headerlink" title="@TestConstructor 어노테이션을 통한 @Autowired 어노테이션 생략"></a>@TestConstructor 어노테이션을 통한 @Autowired 어노테이션 생략</h4><p>테스트 별로 설정이 다를 때 테스트 마다 @TestConstructor를 달고 안 달고 설정할 수 있다.<br>spring.properties에 spring.test.constructor.autowire.mode&#x3D;all로 설정하지 않는 이상 @TestConstructor(autowireMode &#x3D; TestConstructor.AutowireMode.NONE)이 기본 값처럼 동작하기 때문에 전역적으로 ALL로 설정한 게 아닌 이상 AutowireMode.NONE은 굳이 사용할 필요가 없다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@TestConstructor(autowireMode = TestConstructor.AutowireMode.ALL)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeTest</span></span>(</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> a: SomeComponent</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">contextLoad</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="spring-properties-파일을-통한-Autowired-어노테이션-생략"><a href="#spring-properties-파일을-통한-Autowired-어노테이션-생략" class="headerlink" title="spring.properties 파일을 통한 @Autowired 어노테이션 생략"></a>spring.properties 파일을 통한 @Autowired 어노테이션 생략</h4><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/spring-projects/spring-framework/blob/5.2.x/spring-test/src/main/java/org/springframework/test/context/support/TestConstructorUtils.java#L60">TestConstructorUtils.isAutowirableConstructor 메서드</a>에서 전역으로 설정된 값을 가져오기 위해 이런 부분이 있었다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> TestConstructor &#123;</span><br><span class="line">	<span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> SpringProperties.getProperty(TestConstructor.TEST_CONSTRUCTOR_AUTOWIRE_MODE_PROPERTY_NAME);</span><br></pre></td></tr></table></figure>

<p>그리고 TestConstructor에는 TEST_CONSTRUCTOR_AUTOWIRE_MODE_PROPERTY_NAME이 있다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">TEST_CONSTRUCTOR_AUTOWIRE_MODE_PROPERTY_NAME</span> <span class="operator">=</span> <span class="string">&quot;spring.test.constructor.autowire.mode&quot;</span>;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/spring-projects/spring-framework/blob/5.2.x/spring-core/src/main/java/org/springframework/core/SpringProperties.java#L109">SpringProperties 클래스의 getProperty 메서드</a>를 보면 localProperties 변수로부터 프로퍼티를 가져오고 있다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getProperty</span><span class="params">(String key)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> localProperties.getProperty(key);</span><br><span class="line">    <span class="keyword">if</span> (value == <span class="literal">null</span>) &#123;</span><br></pre></td></tr></table></figure>

<p>그리고 localProperties는 static final 변수라서 다시 재할당 되지 않고, <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/spring-projects/spring-framework/blob/5.2.x/spring-core/src/main/java/org/springframework/core/SpringProperties.java#L58">static 초기화 블럭</a>에 의해 어떻게 초기화 되는지 봐보면</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PROPERTIES_RESOURCE_LOCATION</span> <span class="operator">=</span> <span class="string">&quot;spring.properties&quot;</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Properties</span> <span class="variable">localProperties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">cl</span> <span class="operator">=</span> SpringProperties.class.getClassLoader();</span><br><span class="line">        <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> (cl != <span class="literal">null</span> ? cl.getResource(PROPERTIES_RESOURCE_LOCATION) :</span><br><span class="line">        ClassLoader.getSystemResource(PROPERTIES_RESOURCE_LOCATION));</span><br><span class="line">        <span class="keyword">if</span> (url != <span class="literal">null</span>) &#123;</span><br><span class="line">            logger.debug(<span class="string">&quot;Found &#x27;spring.properties&#x27; file in local classpath&quot;</span>);</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> url.openStream();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                localProperties.load(is);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">finally</span> &#123;</span><br><span class="line">                is.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">        <span class="keyword">if</span> (logger.isInfoEnabled()) &#123;</span><br><span class="line">            logger.info(<span class="string">&quot;Could not load &#x27;spring.properties&#x27; file from local classpath: &quot;</span> + ex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>PROPERTIES_RESOURCE_LOCATION 변수에 있는 리소스를 읽어들여서 localProperties에 로딩하는 걸 볼 수 있다.<br>PROPERTIES_RESOURCE_LOCATION 변수도 static final 변수이기 때문에 무조건 classpath 내에 존재하는 <a href="/2020/12/25/spring-properties-file">spring.properties</a>라는 파일로부터 읽어들인다는 사실을 알 수 있다.</p>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.gradle.org/current/userguide/java_plugin.html#sec:java_project_layout">Gradle의 java plugin</a>을 사용하면 기본적으로 src&#x2F;main&#x2F;resources나 src&#x2F;test&#x2F;resources를 classpath에 등록해준다.<br>하지만 spring boot를 사용하기 위해 필수적으로 적용하는 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.spring.io/spring-boot/docs/2.0.0.RELEASE/gradle-plugin/reference/html">Spring Boot Gradle Plugin</a>을 사용하면 Spring Boot 2.0.0.RELEASE 이후부터는 기본적으로 java 플러그인이 적용되기 때문에 따로 적용할 필요가 없다.</p>
<blockquote>
<p>A typical Spring Boot project will apply the groovy, java, or org.jetbrains.kotlin.jvm plugin and the io.spring.dependency-management plugin as a minimum.</p>
</blockquote>
<p>이 설정은 테스트용 설정이기 때문에 <code>src/test/resources에 spring.properties 파일</code>을 만들고 아래와 같이 프로퍼티를 설정하면 된다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.test.constructor.autowire.mode=all</span><br></pre></td></tr></table></figure>

<p>위와 같이 전역에 공통적으로 autowireMode를 설정하고 나면 테스트 코드에서 @TestConstructor 어노테이션을 사용하지 않아도 @Autowired 어노테이션 없이 생성자를 통한 의존성 주입을 받을 수 있다</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeTest</span></span>(</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> a: SomeComponent</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">contextLoad</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Spring-Boot-2-3-x-Spring-5-2-x"><a href="#Spring-Boot-2-3-x-Spring-5-2-x" class="headerlink" title="Spring Boot 2.3.x (Spring 5.2.x)"></a>Spring Boot 2.3.x (Spring 5.2.x)</h3><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/spring-projects/spring-boot/blob/2.3.x/spring-boot-project/spring-boot-dependencies/build.gradle#L1675">Spring Boot 2.3.x는 Spring 5.2.x를 사용</a>하는데 Spring Boot 2.2.x와 동일한 스프링 버전을 사용했기 때문인지 Junit 5에서 Dependency Injection을 위한 변화는 없었다.</p>
<h3 id="Spring-Boot-2-4-x-Spring-5-3-2"><a href="#Spring-Boot-2-4-x-Spring-5-3-2" class="headerlink" title="Spring Boot 2.4.x (Spring 5.3.2)"></a>Spring Boot 2.4.x (Spring 5.3.2)</h3><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/spring-projects/spring-boot/blob/2.4.x/spring-boot-project/spring-boot-dependencies/build.gradle#L1567">Spring Boot 2.4.x는 Spring 5.3.x를 사용</a>하기 때문에 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/spring-projects/spring-framework/blob/master/spring-test/src/main/java/org/springframework/test/context/junit/jupiter/SpringExtension.java#L233">Spring Test 5.3.x의 SpringExtension 클래스를 보면 supportsParameter</a> 메서드의 로직이 달라져있다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supportsParameter</span><span class="params">(ParameterContext parameterContext, ExtensionContext extensionContext)</span> &#123;</span><br><span class="line">    <span class="type">Parameter</span> <span class="variable">parameter</span> <span class="operator">=</span> parameterContext.getParameter();</span><br><span class="line">    <span class="type">Executable</span> <span class="variable">executable</span> <span class="operator">=</span> parameter.getDeclaringExecutable();</span><br><span class="line">    Class&lt;?&gt; testClass = extensionContext.getRequiredTestClass();</span><br><span class="line">    <span class="type">PropertyProvider</span> <span class="variable">junitPropertyProvider</span> <span class="operator">=</span> propertyName -&gt;</span><br><span class="line">    extensionContext.getConfigurationParameter(propertyName).orElse(<span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">return</span> (TestConstructorUtils.isAutowirableConstructor(executable, testClass, junitPropertyProvider) ||</span><br><span class="line">        ApplicationContext.class.isAssignableFrom(parameter.getType()) ||</span><br><span class="line">        ParameterResolutionDelegate.isAutowirable(parameter, parameterContext.getIndex()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>이번엔 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/spring-projects/spring-framework/blob/65a395ef0e96c5e5ce28526d1fe975daaa566b0d/spring-test/src/main/java/org/springframework/test/context/support/TestConstructorUtils.java#L92">TestConstructorUtils.isAutowirableConstructor 메서드</a>에 junitPropertyProvider까지 넘기고 있다.<br>그리고 해당 메서드를 계속 타고 들어가면 아래와 같이 로직이 바뀌어있는 걸 볼 수 있다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isAutowirableConstructor</span><span class="params">(Constructor&lt;?&gt; constructor, Class&lt;?&gt; testClass,</span></span><br><span class="line"><span class="params"><span class="meta">@Nullable</span> PropertyProvider fallbackPropertyProvider)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Is the constructor annotated with @Autowired?</span></span><br><span class="line">    <span class="keyword">if</span> (AnnotatedElementUtils.hasAnnotation(constructor, Autowired.class)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">AutowireMode</span> <span class="variable">autowireMode</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Is the test class annotated with @TestConstructor?</span></span><br><span class="line">    <span class="type">TestConstructor</span> <span class="variable">testConstructor</span> <span class="operator">=</span> TestContextAnnotationUtils.findMergedAnnotation(testClass, TestConstructor.class);</span><br><span class="line">    <span class="keyword">if</span> (testConstructor != <span class="literal">null</span>) &#123;</span><br><span class="line">        autowireMode = testConstructor.autowireMode();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Custom global default from SpringProperties?</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> SpringProperties.getProperty(TestConstructor.TEST_CONSTRUCTOR_AUTOWIRE_MODE_PROPERTY_NAME);</span><br><span class="line">        autowireMode = AutowireMode.from(value);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Use fallback provider?</span></span><br><span class="line">        <span class="keyword">if</span> (autowireMode == <span class="literal">null</span> &amp;&amp; fallbackPropertyProvider != <span class="literal">null</span>) &#123;</span><br><span class="line">            value = fallbackPropertyProvider.get(TestConstructor.TEST_CONSTRUCTOR_AUTOWIRE_MODE_PROPERTY_NAME);</span><br><span class="line">            autowireMode = AutowireMode.from(value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (autowireMode == AutowireMode.ALL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>@Autowired 어노테이션이 달려있으면 true를 반환한다.</li>
<li>autowireMode 변수를 선언하고, null로 초기화한다.</li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/spring-projects/spring-framework/blob/65a395ef0e96c5e5ce28526d1fe975daaa566b0d/spring-test/src/main/java/org/springframework/test/context/TestConstructor.java#L75">@TestConstructor 어노테이션</a>이 달려있는지 확인한다.<ol>
<li>달려있으면 해당 어노테이션의 autowireMode 프로퍼티를 autowireMode 변수에 할단한다.</li>
<li>달려있지 않으면 아래 분기를 탄다.<ol>
<li>클래스 패스에 있는 spring.properties 파일에서 spring.test.constructor.autowire.mode 프로퍼티를 가져온다.</li>
<li>가져온 프로퍼티를 AutowireMode enum으로 변환해서 autowireMode 변수에 할당한다.</li>
<li>AutowireMode enum으로 변환에 실패했는데 fallbackPropertyProvider(junitPropertyProvider)가 존재하면 아래 분기를 탄다.<ol>
<li>junitPropertyProvider에서 spring.test.constructor.autowire.mode 프로퍼티를 가져온다.</li>
<li>프로퍼티를 AutowireMode enum으로 변환해서 autowireMode 변수에 할당한다.</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li>autowireMode 변수가 AutowireMode.ALL과 같으면 true, 다르면 false를 반환한다.</li>
</ol>
<p>junitPropertyProvider로부터 읽어오는 부분이 추가된 건데 추가하는 방법은 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.spring.io/spring-framework/docs/current/reference/html/testing.html#integration-testing-annotations-testconstructor">스프링 공식 문서</a>에 나와있다.</p>
<blockquote>
<p>Changing the default test constructor autowire mode<br>The default test constructor autowire mode can be changed by setting the spring.test.constructor.autowire.mode JVM system property to all.<br>Alternatively, the default mode may be set via the SpringProperties mechanism.<br>As of Spring Framework 5.3, the default mode may also be configured as a JUnit Platform configuration parameter.</p>
</blockquote>
<p>JUnit Platform configuration parameter를 설정하는 방법은 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://junit.org/junit5/docs/current/user-guide/#running-tests-config-params">JUnit 공식문서</a>에 나와있고, junit-platform.properties 파일을 만들어서 클래스패스에 추가하면 적용이 된다.</p>
<blockquote>
<p>The JUnit Platform configuration file: a file named junit-platform.properties in the root of the class path that follows the syntax rules for a Java Properties file.</p>
</blockquote>
<p>spring.properties는 테스트 전용 설정파일이 아닌데 반해 junit-platform.properties 파일은 테스트 전용 설정파일이기 때문에 우리가 설정하려는 값은 테스트 전용 값이라서 junit-platform.properties에 있는 게 더 좋다고 볼 수 있다.</p>
<p><code>/src/test/resources에 junit-platform.properties 파일</code>을 만들어주자.<br>자바 표준 API인 Properties 문법을 따른다고 하니 아래와 같이 적어주면 된다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.test.constructor.autowire.mode=all</span><br></pre></td></tr></table></figure>

<p>위와 같이 전역에 공통적으로 autowireMode를 설정하고 나면 테스트 코드에서 @TestConstructor 어노테이션을 사용하지 않아도 @Autowired 어노테이션 없이 생성자를 통한 의존성 주입을 받을 수 있다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SomeTest</span>(</span><br><span class="line">    <span class="keyword">private</span> val a: SomeComponent</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    fun <span class="title function_">contextLoad</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Spring/" rel="tag"># Spring</a>
              <a href="/tags/Spring-Boot/" rel="tag"># Spring Boot</a>
              <a href="/tags/JUnit/" rel="tag"># JUnit</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2020/12/25/spring-properties-file/" rel="prev" title="spring.properties 파일을 읽어들이는 원리">
                  <i class="fa fa-chevron-left"></i> spring.properties 파일을 읽어들이는 원리
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2020/12/26/intellij-vs-gradle-in-classpath/" rel="next" title="IntelliJ (Spring Boot) vs Gradle (bootRun)에서 클래스패스의 차이점">
                  IntelliJ (Spring Boot) vs Gradle (bootRun)에서 클래스패스의 차이점 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2016 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">양권성</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="external nofollow noopener noreferrer" target="_blank">NexT.Pisces</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>



  <script src="/js/third-party/fancybox.js"></script>


  




<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"exobud","count":true,"i18n":{"disqus":"disqus"}}</script>
<script src="/js/third-party/comments/disqus.js"></script>

</body>
</html>
