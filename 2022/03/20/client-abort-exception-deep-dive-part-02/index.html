<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.0.0-rc1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon/favicon-16x16.png">
  <link rel="mask-icon" href="/images/favicon/safari-pinned-tab.svg" color="#222">
  <link rel="manifest" href="/images/favicon/manifest.json">
  <meta name="google-site-verification" content="yL1R2eDsKDqjPNaOBKp1usSDw8SQNzaO35svs1LKYWw">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"perfectacle.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":true,"version":"8.17.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":false,"color":"#222","save":"manual"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"disqus","storage":true,"lazyload":false,"nav":null,"activeClass":"disqus"},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":true}}</script><script src="/js/config.js"></script>

    <meta name="description" content="서버에서 아주 가끔가다가 ClientAbortException(java.io.IOExceiption: Broken pipe)이 발생해서 어떨 때 발생하는지 딥다이브 해봄.   적다보니 글이 길어져 글을 나누었는데 해당 글을 읽기 전에 (Tomcat) ClientAbortException은 왜 발생할까? (Part 1)을 먼저 보는 것을 추천함.  https">
<meta property="og:type" content="blog">
<meta property="og:title" content="(Tomcat) ClientAbortException은 왜 발생할까? (Part 2)">
<meta property="og:url" content="https://perfectacle.github.io/2022/03/20/client-abort-exception-deep-dive-part-02/index.html">
<meta property="og:site_name" content="오늘도 끄적끄적">
<meta property="og:description" content="서버에서 아주 가끔가다가 ClientAbortException(java.io.IOExceiption: Broken pipe)이 발생해서 어떨 때 발생하는지 딥다이브 해봄.   적다보니 글이 길어져 글을 나누었는데 해당 글을 읽기 전에 (Tomcat) ClientAbortException은 왜 발생할까? (Part 1)을 먼저 보는 것을 추천함.  https">
<meta property="og:locale" content="ko_KR">
<meta property="og:image" content="https://perfectacle.github.io/2022/03/20/client-abort-exception-deep-dive-part-02/stacktrace.png">
<meta property="og:image" content="https://perfectacle.github.io/2022/03/20/client-abort-exception-deep-dive-part-02/large-response-in-read-timeout-tcp-3-way-handshake.png">
<meta property="og:image" content="https://perfectacle.github.io/2022/03/20/client-abort-exception-deep-dive-part-02/tcp-3-way-handshake.png">
<meta property="og:image" content="https://perfectacle.github.io/2022/03/20/client-abort-exception-deep-dive-part-02/large-response-in-read-timeout-tcp-3-way-handshake-socket-status.png">
<meta property="og:image" content="https://perfectacle.github.io/2022/03/20/client-abort-exception-deep-dive-part-02/large-response-in-read-timeout-send-http-request-packet.png">
<meta property="og:image" content="https://perfectacle.github.io/2022/03/20/client-abort-exception-deep-dive-part-02/large-response-in-read-timeout-send-http-request-ack-packet.png">
<meta property="og:image" content="https://perfectacle.github.io/2022/03/20/client-abort-exception-deep-dive-part-02/large-response-in-read-timeout-send-http-response-packet-01.png">
<meta property="og:image" content="https://perfectacle.github.io/2022/03/20/client-abort-exception-deep-dive-part-02/large-response-in-read-timeout-send-http-response-packet-02.png">
<meta property="og:image" content="https://perfectacle.github.io/2022/03/20/client-abort-exception-deep-dive-part-02/large-response-in-read-timeout-send-http-response-ack-packet-01.png">
<meta property="og:image" content="https://perfectacle.github.io/2022/03/20/client-abort-exception-deep-dive-part-02/large-response-in-read-timeout-send-http-response-packet-03.png">
<meta property="og:image" content="https://perfectacle.github.io/2022/03/20/client-abort-exception-deep-dive-part-02/large-response-in-read-timeout-send-http-response-ack-packet-02.png">
<meta property="og:image" content="https://perfectacle.github.io/2022/03/20/client-abort-exception-deep-dive-part-02/large-response-in-read-timeout-tcp-connection-termination.png">
<meta property="og:image" content="https://perfectacle.github.io/2022/03/20/client-abort-exception-deep-dive-part-02/tcp-termination.png">
<meta property="og:image" content="https://perfectacle.github.io/2022/03/20/client-abort-exception-deep-dive-part-02/large-response-in-read-timeout-tcp-time-wait-socket-status.png">
<meta property="og:image" content="https://perfectacle.github.io/2022/03/20/client-abort-exception-deep-dive-part-02/large-response-in-read-timeout-tcp-socket-status.png">
<meta property="og:image" content="https://perfectacle.github.io/2022/03/20/client-abort-exception-deep-dive-part-02/stream-response-over-read-timeout-tcp-3-way-handshake.png">
<meta property="og:image" content="https://perfectacle.github.io/2022/03/20/client-abort-exception-deep-dive-part-02/tcp-3-way-handshake.png">
<meta property="og:image" content="https://perfectacle.github.io/2022/03/20/client-abort-exception-deep-dive-part-02/stream-response-over-read-timeout-send-http-request-packet.png">
<meta property="og:image" content="https://perfectacle.github.io/2022/03/20/client-abort-exception-deep-dive-part-02/stream-response-over-read-timeout-send-http-request-ack-packet.png">
<meta property="og:image" content="https://perfectacle.github.io/2022/03/20/client-abort-exception-deep-dive-part-02/stream-response-over-read-timeout-send-http-response-packet-01.png">
<meta property="og:image" content="https://perfectacle.github.io/2022/03/20/client-abort-exception-deep-dive-part-02/stream-response-over-read-timeout-send-http-response-ack-packet-01.png">
<meta property="og:image" content="https://perfectacle.github.io/2022/03/20/client-abort-exception-deep-dive-part-02/stream-response-over-read-timeout-send-http-response-packet-02.png">
<meta property="og:image" content="https://perfectacle.github.io/2022/03/20/client-abort-exception-deep-dive-part-02/stream-response-over-read-timeout-send-http-response-ack-packet-02.png">
<meta property="og:image" content="https://perfectacle.github.io/2022/03/20/client-abort-exception-deep-dive-part-02/stream-response-over-read-timeout-send-fin-packet.png">
<meta property="og:image" content="https://perfectacle.github.io/2022/03/20/client-abort-exception-deep-dive-part-02/stream-response-over-read-timeout-send-ack-packet.png">
<meta property="og:image" content="https://perfectacle.github.io/2022/03/20/client-abort-exception-deep-dive-part-02/tcp-termination.png">
<meta property="og:image" content="https://perfectacle.github.io/2022/03/20/client-abort-exception-deep-dive-part-02/stream-response-over-read-timeout-send-http-response-packet-03.png">
<meta property="og:image" content="https://perfectacle.github.io/2022/03/20/client-abort-exception-deep-dive-part-02/stream-response-over-read-timeout-send-rst-packet.png">
<meta property="article:published_time" content="2022-03-20T10:30:19.000Z">
<meta property="article:modified_time" content="2023-07-09T16:05:24.575Z">
<meta property="article:author" content="양권성">
<meta property="article:tag" content="Spring Boot">
<meta property="article:tag" content="Tomcat">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://perfectacle.github.io/2022/03/20/client-abort-exception-deep-dive-part-02/stacktrace.png">


<link rel="canonical" href="https://perfectacle.github.io/2022/03/20/client-abort-exception-deep-dive-part-02/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"ko","comments":true,"permalink":"https://perfectacle.github.io/2022/03/20/client-abort-exception-deep-dive-part-02/","path":"2022/03/20/client-abort-exception-deep-dive-part-02/","title":"(Tomcat) ClientAbortException은 왜 발생할까? (Part 2)"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>(Tomcat) ClientAbortException은 왜 발생할까? (Part 2) | 오늘도 끄적끄적</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-87795455-1"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-87795455-1","only_pageview":false}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>







<!--<script data-ad-client="ca-pub-3881550906962162" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>-->
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="오늘도 끄적끄적" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">오늘도 끄적끄적</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">느리더라도 꾸준하게</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="검색" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>홈</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>정보</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>태그<span class="badge">258</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>카테고리<span class="badge">50</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>아카이브<span class="badge">219</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>검색
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          목차
        </li>
        <li class="sidebar-nav-overview">
          흝어보기
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#N%EC%A4%84-%EC%9A%94%EC%95%BD"><span class="nav-number">1.</span> <span class="nav-text">N줄 요약</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%ED%81%B4%EB%9D%BC%EC%9D%B4%EC%96%B8%ED%8A%B8%EA%B0%80-%EC%9D%91%EB%8B%B5-%ED%8C%A8%ED%82%B7%EC%9D%84-%EB%B0%9B%EB%8A%94-%EC%8B%9C%EA%B0%84%EC%9D%B4-Read-Timout%EC%9D%84-%EC%B4%88%EA%B3%BC%ED%95%9C-%EA%B2%BD%EC%9A%B0"><span class="nav-number">2.</span> <span class="nav-text">클라이언트가 응답 패킷을 받는 시간이 Read Timout을 초과한 경우</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%EA%B0%81-%EC%9D%91%EB%8B%B5-%ED%8C%A8%ED%82%B7%EC%9D%98-%EC%8B%9C%EA%B0%84-%EA%B0%84%EA%B2%A9%EC%9D%80-Read-Timeout-%EC%95%88%EC%97%90-%EC%99%94%EC%A7%80%EB%A7%8C-%EB%AA%A8%EB%93%A0-%EC%9D%91%EB%8B%B5-%ED%8C%A8%ED%82%B7%EC%9D%80-Read-Timeout-%EC%95%88%EC%97%90-%EC%98%A4%EC%A7%80-%EC%95%8A%EC%9D%80-%EA%B2%BD%EC%9A%B0"><span class="nav-number">2.1.</span> <span class="nav-text">1. 각 응답 패킷의 시간 간격은 Read Timeout 안에 왔지만 모든 응답 패킷은 Read Timeout 안에 오지 않은 경우</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%8D%B0%EB%AA%A8-%EC%98%81%EC%83%81"><span class="nav-number">2.1.1.</span> <span class="nav-text">데모 영상</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%ED%81%B4%EB%9D%BC%EC%9D%B4%EC%96%B8%ED%8A%B8-%EB%A1%9C%EA%B7%B8-%EC%BD%98%EC%86%94%EC%97%90-%EC%9D%91%EB%8B%B5%EC%9D%84-%EB%A1%9C%EA%B9%85%ED%95%98%EB%8A%90%EB%9D%BC-%EC%A7%A4%EB%A6%BC%E2%80%A6"><span class="nav-number">2.1.2.</span> <span class="nav-text">클라이언트 로그 (콘솔에 응답을 로깅하느라 짤림…)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EC%84%9C%EB%B2%84-%EB%A1%9C%EA%B7%B8"><span class="nav-number">2.1.3.</span> <span class="nav-text">서버 로그</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%ED%8C%A8%ED%82%B7-%EB%A1%9C%EA%B7%B8-%EC%86%8C%EC%BC%93-%EC%83%81%ED%83%9C"><span class="nav-number">2.1.4.</span> <span class="nav-text">패킷 로그 (소켓 상태)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%EA%B0%81-%EC%9D%91%EB%8B%B5-%ED%8C%A8%ED%82%B7%EC%9D%98-%EC%8B%9C%EA%B0%84-%EA%B0%84%EA%B2%A9%EC%9D%B4-Read-Timeout-%EC%95%88%EC%97%90-%EC%98%A4%EC%A7%80-%EC%95%8A%EC%9D%80-%EA%B2%BD%EC%9A%B0"><span class="nav-number">2.2.</span> <span class="nav-text">2. 각 응답 패킷의 시간 간격이 Read Timeout 안에 오지 않은 경우</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%8D%B0%EB%AA%A8-%EC%98%81%EC%83%81-1"><span class="nav-number">2.2.1.</span> <span class="nav-text">데모 영상</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%ED%81%B4%EB%9D%BC%EC%9D%B4%EC%96%B8%ED%8A%B8-%EB%A1%9C%EA%B7%B8"><span class="nav-number">2.2.2.</span> <span class="nav-text">클라이언트 로그</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EC%84%9C%EB%B2%84-%EB%A1%9C%EA%B7%B8-1"><span class="nav-number">2.2.3.</span> <span class="nav-text">서버 로그</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%ED%8C%A8%ED%82%B7-%EB%A1%9C%EA%B7%B8"><span class="nav-number">2.2.4.</span> <span class="nav-text">패킷 로그</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ClientAbortException%EC%9D%84-%ED%95%B4%EA%B2%B0%ED%95%98%EB%A0%A4%EB%A9%B4"><span class="nav-number">3.</span> <span class="nav-text">ClientAbortException을 해결하려면?</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="양권성" src="/images/avatar/avatar.png">
  <p class="site-author-name" itemprop="name">양권성</p>
  <div class="site-description" itemprop="description">Toss Server Developer</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">219</span>
          <span class="site-state-item-name">포스트</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">50</span>
        <span class="site-state-item-name">카테고리</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">258</span>
        <span class="site-state-item-name">태그</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/perfectacle" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;perfectacle" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:perfectacle@gmail.com" title="E-Mail → mailto:perfectacle@gmail.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.facebook.com/perfectacle" title="FB Page → https:&#x2F;&#x2F;www.facebook.com&#x2F;perfectacle" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-facebook fa-fw"></i></a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="ko">
    <link itemprop="mainEntityOfPage" href="https://perfectacle.github.io/2022/03/20/client-abort-exception-deep-dive-part-02/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar/avatar.png">
      <meta itemprop="name" content="양권성">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="오늘도 끄적끄적">
      <meta itemprop="description" content="Toss Server Developer">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="(Tomcat) ClientAbortException은 왜 발생할까? (Part 2) | 오늘도 끄적끄적">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          (Tomcat) ClientAbortException은 왜 발생할까? (Part 2)
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">작성일</span>

      <time title="Post created: 2022-03-20 10:30:19" itemprop="dateCreated datePublished" datetime="2022-03-20T10:30:19+00:00">2022-03-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/tomcat/" itemprop="url" rel="index"><span itemprop="name">tomcat</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2022/03/20/client-abort-exception-deep-dive-part-02/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2022/03/20/client-abort-exception-deep-dive-part-02/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>서버에서 아주 가끔가다가 ClientAbortException(java.io.IOExceiption: Broken pipe)이 발생해서 어떨 때 발생하는지 딥다이브 해봄.</p>
<img src="/2022/03/20/client-abort-exception-deep-dive-part-02/stacktrace.png" class>

<p>적다보니 글이 길어져 글을 나누었는데 해당 글을 읽기 전에 <a href="/2022/03/20/client-abort-exception-deep-dive-part-01">(Tomcat) ClientAbortException은 왜 발생할까? (Part 1)</a>을 먼저 보는 것을 추천함.</p>
<hr>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://tomcat.apache.org/tomcat-9.0-doc/api/org/apache/catalina/connector/ClientAbortException.html">https://tomcat.apache.org/tomcat-9.0-doc/api/org/apache/catalina/connector/ClientAbortException.html</a></p>
<blockquote>
<p>Extend IOException to identify it as being caused by an abort of a request by a remote client.</p>
</blockquote>
<p>외부 클라이언트 측에서 요청을 abort(중단) 시켰을 때 발생하는 예외로 보인다.<br>톰캣에서 발생시키는 예외인데 Spring Boot의 Web(Mvc) 모듈에서 기본적으로 사용하는 게 Embedded Tomcat이기 때문에 많은 분들께서 자주 마주치지 않았을까… 싶다.<br>구글링 해보면 뭐 브라우저 이슈(API 응답이 오기 전에 새로고침을 했다던가, 뒤로가기를 했다던가 등등)니 뭐니 하는데 내가 겪은 상황은 server → server 통신에서 발생한 것이기 때문에 서버 간의 통신 관점에서만 파보았다.</p>
<p>삽질을 해보고 싶은 사람은 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/perfectacle/client-abort-exception-playground">https://github.com/perfectacle/client-abort-exception-playground</a> 을 clone 하면 된다.</p>
<p>그리고 ClientAbortException이 발생해도 스프링에서 기본적으로 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.baeldung.com/exception-handling-for-rest-with-spring#exceptionresolver">HandlerExceptionResolver</a>에서 예외를 핸들링하기 때문에 로그에는 아무것도 남지 않는다.<br>따라서 해당 에러가 발생하는지 에러 로그로 명확히 확인해보는 게 훨씬 직관적이기 때문에 아래 @RestControllerAdvice를 추가했다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ControllerAdvice</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> log = LoggerFactory.getLogger(<span class="keyword">this</span>::<span class="keyword">class</span>.java)</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(value = [Exception::class])</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">handleException</span><span class="params">(e: <span class="type">Exception</span>)</span></span>: ResponseEntity&lt;<span class="built_in">Void</span>&gt; &#123;</span><br><span class="line">        log.error(e.message, e)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.internalServerError().build()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="N줄-요약"><a href="#N줄-요약" class="headerlink" title="N줄 요약"></a>N줄 요약</h1><ol>
<li>클라이언트가 응답 패킷을 받는 와중에 Read Timeout 시간을 초과하면<ol>
<li>각 응답 패킷의 시간 간격은 Read Timeout 안에 왔지만 모든 응답 패킷은 Read Timeout 안에 오지 않았다면<ol>
<li>Read Timeout의 의미는 모든 응답 패킷을 받는데까지 걸리는 시간이 아니라 각 응답 패킷 사이의 Timeout을 의미한다. (그래서 Apach HTTP Client는 오해의 소지를 줄이고자인지 socketTimeout이라고 부르고 있다.)</li>
<li>따라서 총 응답 패킷을 다 받는데까지는 Read Timeout에 설정한 시간을 초과해도 클라이언트&#x2F;서버 모두 아무런 오류가 발생하지 않는다.</li>
</ol>
</li>
<li>각 응답 패킷의 시간 간격이 Read Timeout 안에 오지 않은 경우<ol>
<li>Read Timeout의 의미는 각 응답 패킷 사이의 Timeout을 의미한다.</li>
<li>응답 패킷이 계속해서 잘 오다가 특정 패킷 하나만 Read Timeout을 초과하더라도 Read Timeout이 발생한다.</li>
<li>클라이언트 측에서 Read Timeout이 발생해서 소켓을 종료한 이후에도 <code>서버 측에서 응답 패킷을 보내면 ClientAbortException이 발생한다</code>.</li>
</ol>
</li>
</ol>
</li>
<li><a href="#ClientAbortException%EC%9D%84-%ED%95%B4%EA%B2%B0%ED%95%98%EB%A0%A4%EB%A9%B4">ClientAbortException을 해결하려면?</a></li>
<li>프로세스(메인 함수)가 종료되더라도 Passive Close로부터 FIN 패킷을 받지 않으면 클라이언트&#x2F;서버의 소켓은 닫히지 않는다. (오동작을 막기 위해 대기하는 것으로 알고 있음.)<br>하지만 Passive Close로부터 FIN 패킷이 아닌 다른 패킷이 오면 Active Close에서는 RST 패킷을 보낸 후 소켓을 닫는다.<br>60초(OS마다 다르지만 tcp_fin_timeout(대다수의 리눅스는 60로초 설정됨) 만큼) 동안 대기 후에도 Passive Close에게 아무런 패킷이 오지 않으면 Active Close는 RST 패킷을 보내고 소켓을 닫는다.<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mac (60_000ms)</span></span><br><span class="line">sysctl -a | grep net.inet.tcp.fin_timeout</span><br><span class="line">net.inet.tcp.fin_timeout: 60000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">linux alpine (60s)</span></span><br><span class="line">sysctl -a | grep net.ipv4.tcp_fin_timeout</span><br><span class="line">net.ipv4.tcp_fin_timeout = 60</span><br></pre></td></tr></table></figure></li>
<li>소켓이 정상 종료된 경우에 ACTIVE_CLOSE 측에서 소켓이 바로 사라지는 게 아니라 오동작을 막기 위해 TIME_WAIT 상태로 대기하다가 사라지게 되는데 그 전까지는 해당 소켓(로컬ip:로컬port, 서버ip:서버port 쌍)을 사용하지 못한다.<br>대기 시간은 대부분 60초(OS마다 다르지만 2 * MSL(Maximum Segment Lifetime, OS 커널 레벨에 하드코딩 돼있는데 대다수의 리눅스는 60로초 설정됨) 동안 대기 후에 사라지게 된다.<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mac (2 * msl = 2 * 15_000ms = 30_000ms)</span></span><br><span class="line">sysctl -a | grep net.inet.tcp.msl</span><br><span class="line">net.inet.tcp.msl: 15000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">linux alpine</span></span><br><span class="line">sysctl -a | grep msl</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">몇몇 linux os는 tcp_fin_timeout을 2*msl로 사용하는 os도 있다고 함. (alpine linux도 아무것도 안 나오는 거 보면 그런 거 같음)</span></span><br></pre></td></tr></table></figure></li>
<li>HTTP Client 구현체마다 다르겠지만 Apache HTTP Client의 경우 Keep-Alive를 사용한다고 했음에도 불구하고 요청이 정상적으로 처리되지 않는 경우(Read Timeout 발생, 500 Internal Sever Error 응답을 받는다던지… 모든 4xx, 5xx가 포함되는 건 아님)에는 커넥션을 커넥션 풀에 반납하지 않고(재사용하지 않고) 종료한다.</li>
</ol>
<h1 id="클라이언트가-응답-패킷을-받는-시간이-Read-Timout을-초과한-경우"><a href="#클라이언트가-응답-패킷을-받는-시간이-Read-Timout을-초과한-경우" class="headerlink" title="클라이언트가 응답 패킷을 받는 시간이 Read Timout을 초과한 경우"></a>클라이언트가 응답 패킷을 받는 시간이 Read Timout을 초과한 경우</h1><h2 id="1-각-응답-패킷의-시간-간격은-Read-Timeout-안에-왔지만-모든-응답-패킷은-Read-Timeout-안에-오지-않은-경우"><a href="#1-각-응답-패킷의-시간-간격은-Read-Timeout-안에-왔지만-모든-응답-패킷은-Read-Timeout-안에-오지-않은-경우" class="headerlink" title="1. 각 응답 패킷의 시간 간격은 Read Timeout 안에 왔지만 모든 응답 패킷은 Read Timeout 안에 오지 않은 경우"></a>1. 각 응답 패킷의 시간 간격은 Read Timeout 안에 왔지만 모든 응답 패킷은 Read Timeout 안에 오지 않은 경우</h2><p>서버 쪽 API에서 큰 응답을 준다고 가정</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LargeResponseController</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> log = LoggerFactory.getLogger(<span class="keyword">this</span>::<span class="keyword">class</span>.java)</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(<span class="string">&quot;/large&quot;</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">slow</span><span class="params">()</span></span>: String &#123;</span><br><span class="line">        log.info(<span class="string">&quot;request is arrived!&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;done!&quot;</span>.repeat(<span class="number">1_000_000</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>클라이언트 측은 응답을 받다가 끊어야하기 때문에 리드 타임아웃 설정을 25ms로 매우 짧게 설정함.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> readTimeout = Duration.ofMillis(<span class="number">25L</span>)</span><br><span class="line">    <span class="keyword">val</span> restTemplate = RestTemplate(</span><br><span class="line">        HttpComponentsClientHttpRequestFactory(</span><br><span class="line">            HttpClientBuilder</span><br><span class="line">                .create()</span><br><span class="line">                .setMaxConnPerRoute(<span class="number">100</span>)</span><br><span class="line">                .setMaxConnTotal(<span class="number">100</span>)</span><br><span class="line">                .setKeepAliveStrategy(DefaultConnectionKeepAliveStrategy())</span><br><span class="line">                .setDefaultRequestConfig(</span><br><span class="line">                    RequestConfig.custom().setSocketTimeout(readTimeout.toMillis().toInt()).build()</span><br><span class="line">                )</span><br><span class="line">                .build()</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        restTemplate.getForObject(<span class="string">&quot;http://localhost:8080/large&quot;</span>, String::<span class="keyword">class</span>.java)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e: Exception) &#123;</span><br><span class="line">        e.printStackTrace()</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        println(<span class="string">&quot;[<span class="subst">$&#123;LocalDateTime.now()&#125;</span>] request is done!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 커넥션 풀에 있는 커넥션을 바로 종료하지 않기 위해 10초간 슬립</span></span><br><span class="line">    Thread.sleep(<span class="number">10_000L</span>)</span><br><span class="line">    println(<span class="string">&quot;[<span class="subst">$&#123;LocalDateTime.now()&#125;</span>] main function is done!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="데모-영상"><a href="#데모-영상" class="headerlink" title="데모 영상"></a>데모 영상</h3><div class="video-container"><iframe src="https://www.youtube.com/embed/BPnMAVpJnTI" frameborder="0" loading="lazy" allowfullscreen></iframe></div>

<h3 id="클라이언트-로그-콘솔에-응답을-로깅하느라-짤림…"><a href="#클라이언트-로그-콘솔에-응답을-로깅하느라-짤림…" class="headerlink" title="클라이언트 로그 (콘솔에 응답을 로깅하느라 짤림…)"></a>클라이언트 로그 (콘솔에 응답을 로깅하느라 짤림…)</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">06</span>:<span class="number">56</span>:<span class="number">05.670</span> [main] DEBUG org.apache.http.wire - http-outgoing-<span class="number">0</span> &lt;&lt; <span class="string">&quot;done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!do&quot;</span></span><br><span class="line"><span class="number">06</span>:<span class="number">56</span>:<span class="number">05.670</span> [main] DEBUG org.apache.http.wire - http-outgoing-<span class="number">0</span> &lt;&lt; <span class="string">&quot;ne!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done&quot;</span></span><br><span class="line"><span class="number">06</span>:<span class="number">56</span>:<span class="number">05.670</span> [main] DEBUG org.apache.http.wire - http-outgoing-<span class="number">0</span> &lt;&lt; <span class="string">&quot;!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!d&quot;</span></span><br><span class="line"><span class="number">06</span>:<span class="number">56</span>:<span class="number">05.670</span> [main] DEBUG org.apache.http.wire - http-outgoing-<span class="number">0</span> &lt;&lt; <span class="string">&quot;one!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!don&quot;</span></span><br><span class="line"><span class="number">06</span>:<span class="number">56</span>:<span class="number">05.670</span> [main] DEBUG org.apache.http.wire - http-outgoing-<span class="number">0</span> &lt;&lt; <span class="string">&quot;e!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!done!&quot;</span></span><br><span class="line"><span class="number">06</span>:<span class="number">56</span>:<span class="number">05.670</span> [main] DEBUG org.apache.http.impl.conn.PoolingHttpClientConnectionManager - Connection [id: <span class="number">0</span>][route: &#123;&#125;-&gt;http:<span class="comment">//localhost:8080] can be kept alive for 60.0 seconds</span></span><br><span class="line"><span class="number">06</span>:<span class="number">56</span>:<span class="number">05.670</span> [main] DEBUG org.apache.http.impl.conn.DefaultManagedHttpClientConnection - http-outgoing-<span class="number">0</span>: <span class="keyword">set</span> socket timeout to <span class="number">0</span></span><br><span class="line"><span class="number">06</span>:<span class="number">56</span>:<span class="number">05.670</span> [main] DEBUG org.apache.http.impl.conn.PoolingHttpClientConnectionManager - Connection released: [id: <span class="number">0</span>][route: &#123;&#125;-&gt;http:<span class="comment">//localhost:8080][total available: 1; route allocated: 1 of 100; total allocated: 1 of 100]</span></span><br><span class="line">[<span class="number">2022</span>-<span class="number">03</span>-20T06:<span class="number">56</span>:<span class="number">05.674</span>] request <span class="keyword">is</span> done!</span><br><span class="line">[<span class="number">2022</span>-<span class="number">03</span>-20T06:<span class="number">56</span>:<span class="number">15.679</span>] main function <span class="keyword">is</span> done!</span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure>
<ol>
<li>06:56:05.670에 마지막 응답 패킷을 받음 (<code>06:56:05.670 [main] DEBUG org.apache.http.wire - http-outgoing-0 &lt;&lt; &quot;e!done!done!done!done!done!done!done!done!done!done!don...</code>)</li>
<li>06:56:05.670에 커넥션을 종료하지 않고 커넥션 풀에 반납함 (Keep-Alive 설정에 따라 60초 동안 idle 상태의 커넥션이라도 보관함, <code>06:56:05.670 [main] DEBUG org.apache.http.impl.conn.PoolingHttpClientConnectionManager - Connection released: [id: 0][route: &#123;&#125;-&gt;http://localhost:8080][total available: 1; route allocated: 1 of 100; total allocated: 1 of 100]</code>)</li>
<li>06:56:15.679에 메인함수 종료</li>
</ol>
<h3 id="서버-로그"><a href="#서버-로그" class="headerlink" title="서버 로그"></a>서버 로그</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">06</span>:<span class="number">56</span>:<span class="number">05.568</span>  INFO <span class="number">86561</span> --- [nio-<span class="number">8080</span>-exec-<span class="number">1</span>] c.e.playground.LargeResponseController   : request <span class="keyword">is</span> arrived!</span><br></pre></td></tr></table></figure>
<ol>
<li>06:56:05.568에 요청 도착</li>
</ol>
<h3 id="패킷-로그-소켓-상태"><a href="#패킷-로그-소켓-상태" class="headerlink" title="패킷 로그 (소켓 상태)"></a>패킷 로그 (소켓 상태)</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">231</span>	<span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">06</span>:<span class="number">56</span>:<span class="number">05.565966</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	TCP	<span class="number">68</span>	<span class="number">51612</span> → <span class="number">8080</span> [SYN] Seq=<span class="number">0</span> Win=<span class="number">65535</span> Len=<span class="number">0</span> MSS=<span class="number">16344</span> WS=<span class="number">64</span> TSval=<span class="number">4237975396</span> TSecr=<span class="number">0</span> SACK_PERM=<span class="number">1</span></span><br><span class="line"><span class="number">232</span>	<span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">06</span>:<span class="number">56</span>:<span class="number">05.566176</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	TCP	<span class="number">68</span>	<span class="number">8080</span> → <span class="number">51612</span> [SYN, ACK] Seq=<span class="number">0</span> Ack=<span class="number">1</span> Win=<span class="number">65535</span> Len=<span class="number">0</span> MSS=<span class="number">16344</span> WS=<span class="number">64</span> TSval=<span class="number">3590453492</span> TSecr=<span class="number">4237975396</span> SACK_PERM=<span class="number">1</span></span><br><span class="line"><span class="number">233</span>	<span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">06</span>:<span class="number">56</span>:<span class="number">05.566202</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	TCP	<span class="number">56</span>	<span class="number">51612</span> → <span class="number">8080</span> [ACK] Seq=<span class="number">1</span> Ack=<span class="number">1</span> Win=<span class="number">408256</span> Len=<span class="number">0</span> TSval=<span class="number">4237975396</span> TSecr=<span class="number">3590453492</span></span><br><span class="line"><span class="number">234</span>	<span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">06</span>:<span class="number">56</span>:<span class="number">05.566226</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	TCP	<span class="number">56</span>	[TCP Window Update] <span class="number">8080</span> → <span class="number">51612</span> [ACK] Seq=<span class="number">1</span> Ack=<span class="number">1</span> Win=<span class="number">408256</span> Len=<span class="number">0</span> TSval=<span class="number">3590453492</span> TSecr=<span class="number">4237975396</span></span><br><span class="line"><span class="number">235</span>	<span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">06</span>:<span class="number">56</span>:<span class="number">05.568288</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	HTTP	<span class="number">274</span>	GET /large HTTP/<span class="number">1.1</span></span><br><span class="line"><span class="number">236</span>	<span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">06</span>:<span class="number">56</span>:<span class="number">05.568329</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	TCP	<span class="number">56</span>	<span class="number">8080</span> → <span class="number">51612</span> [ACK] Seq=<span class="number">1</span> Ack=<span class="number">219</span> Win=<span class="number">408064</span> Len=<span class="number">0</span> TSval=<span class="number">3590453495</span> TSecr=<span class="number">4237975399</span></span><br><span class="line"><span class="number">237</span>	<span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">06</span>:<span class="number">56</span>:<span class="number">05.582682</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	TCP	<span class="number">8248</span>	<span class="number">8080</span> → <span class="number">51612</span> [PSH, ACK] Seq=<span class="number">1</span> Ack=<span class="number">219</span> Win=<span class="number">408064</span> Len=<span class="number">8192</span> TSval=<span class="number">3590453510</span> TSecr=<span class="number">4237975399</span> [TCP segment of a reassembled PDU]</span><br><span class="line"><span class="number">238</span>	<span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">06</span>:<span class="number">56</span>:<span class="number">05.582700</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	TCP	<span class="number">8248</span>	<span class="number">8080</span> → <span class="number">51612</span> [PSH, ACK] Seq=<span class="number">8193</span> Ack=<span class="number">219</span> Win=<span class="number">408064</span> Len=<span class="number">8192</span> TSval=<span class="number">3590453510</span> TSecr=<span class="number">4237975399</span> [TCP segment of a reassembled PDU]</span><br><span class="line"><span class="number">239</span>	<span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">06</span>:<span class="number">56</span>:<span class="number">05.582717</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	TCP	<span class="number">8248</span>	<span class="number">8080</span> → <span class="number">51612</span> [PSH, ACK] Seq=<span class="number">16385</span> Ack=<span class="number">219</span> Win=<span class="number">408064</span> Len=<span class="number">8192</span> TSval=<span class="number">3590453510</span> TSecr=<span class="number">4237975399</span> [TCP segment of a reassembled PDU]</span><br><span class="line"><span class="number">240</span>	<span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">06</span>:<span class="number">56</span>:<span class="number">05.582730</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	TCP	<span class="number">8248</span>	<span class="number">8080</span> → <span class="number">51612</span> [PSH, ACK] Seq=<span class="number">24577</span> Ack=<span class="number">219</span> Win=<span class="number">408064</span> Len=<span class="number">8192</span> TSval=<span class="number">3590453510</span> TSecr=<span class="number">4237975399</span> [TCP segment of a reassembled PDU]</span><br><span class="line"><span class="number">241</span>	<span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">06</span>:<span class="number">56</span>:<span class="number">05.582740</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	TCP	<span class="number">56</span>	<span class="number">51612</span> → <span class="number">8080</span> [ACK] Seq=<span class="number">219</span> Ack=<span class="number">8193</span> Win=<span class="number">400064</span> Len=<span class="number">0</span> TSval=<span class="number">4237975414</span> TSecr=<span class="number">3590453510</span></span><br><span class="line">...</span><br><span class="line"><span class="number">856</span>	<span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">06</span>:<span class="number">56</span>:<span class="number">05.648652</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	TCP	<span class="number">12387</span>	<span class="number">8080</span> → <span class="number">51612</span> [PSH, ACK] Seq=<span class="number">4987837</span> Ack=<span class="number">219</span> Win=<span class="number">408064</span> Len=<span class="number">12331</span> TSval=<span class="number">3590453575</span> TSecr=<span class="number">4237975479</span> [TCP segment of a reassembled PDU]</span><br><span class="line"><span class="number">857</span>	<span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">06</span>:<span class="number">56</span>:<span class="number">05.648660</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	TCP	<span class="number">56</span>	<span class="number">51612</span> → <span class="number">8080</span> [ACK] Seq=<span class="number">219</span> Ack=<span class="number">4987837</span> Win=<span class="number">250048</span> Len=<span class="number">0</span> TSval=<span class="number">4237975479</span> TSecr=<span class="number">3590453575</span></span><br><span class="line"><span class="number">858</span>	<span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">06</span>:<span class="number">56</span>:<span class="number">05.653137</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	TCP	<span class="number">12387</span>	[TCP Retransmission] <span class="number">8080</span> → <span class="number">51612</span> [PSH, ACK] Seq=<span class="number">4987837</span> Ack=<span class="number">219</span> Win=<span class="number">408064</span> Len=<span class="number">12331</span> TSval=<span class="number">3590453579</span> TSecr=<span class="number">4237975479</span></span><br><span class="line"><span class="number">859</span>	<span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">06</span>:<span class="number">56</span>:<span class="number">05.653169</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	TCP	<span class="number">68</span>	<span class="number">51612</span> → <span class="number">8080</span> [ACK] Seq=<span class="number">219</span> Ack=<span class="number">5000168</span> Win=<span class="number">499008</span> Len=<span class="number">0</span> TSval=<span class="number">4237975483</span> TSecr=<span class="number">3590453575</span> SLE=<span class="number">4987837</span> SRE=<span class="number">5000168</span></span><br><span class="line"><span class="number">860</span>	<span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">06</span>:<span class="number">56</span>:<span class="number">05.666381</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	TCP	<span class="number">56</span>	[TCP Window Update] <span class="number">51612</span> → <span class="number">8080</span> [ACK] Seq=<span class="number">219</span> Ack=<span class="number">5000168</span> Win=<span class="number">763648</span> Len=<span class="number">0</span> TSval=<span class="number">4237975497</span> TSecr=<span class="number">3590453575</span></span><br><span class="line"><span class="number">861</span>	<span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">06</span>:<span class="number">56</span>:<span class="number">05.670136</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	TCP	<span class="number">56</span>	[TCP Window Update] <span class="number">51612</span> → <span class="number">8080</span> [ACK] Seq=<span class="number">219</span> Ack=<span class="number">5000168</span> Win=<span class="number">1025792</span> Len=<span class="number">0</span> TSval=<span class="number">4237975500</span> TSecr=<span class="number">3590453575</span></span><br><span class="line"><span class="number">866</span>	<span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">06</span>:<span class="number">56</span>:<span class="number">16.068837</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	TCP	<span class="number">56</span>	<span class="number">51612</span> → <span class="number">8080</span> [FIN, ACK] Seq=<span class="number">219</span> Ack=<span class="number">5000168</span> Win=<span class="number">1045248</span> Len=<span class="number">0</span> TSval=<span class="number">4237985900</span> TSecr=<span class="number">3590453575</span></span><br><span class="line"><span class="number">867</span>	<span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">06</span>:<span class="number">56</span>:<span class="number">16.068992</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	TCP	<span class="number">56</span>	<span class="number">8080</span> → <span class="number">51612</span> [ACK] Seq=<span class="number">5000168</span> Ack=<span class="number">220</span> Win=<span class="number">408064</span> Len=<span class="number">0</span> TSval=<span class="number">3590463996</span> TSecr=<span class="number">4237985900</span></span><br><span class="line"><span class="number">870</span>	<span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">06</span>:<span class="number">56</span>:<span class="number">16.069677</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	TCP	<span class="number">56</span>	<span class="number">8080</span> → <span class="number">51612</span> [FIN, ACK] Seq=<span class="number">5000168</span> Ack=<span class="number">220</span> Win=<span class="number">408064</span> Len=<span class="number">0</span> TSval=<span class="number">3590463996</span> TSecr=<span class="number">4237985900</span></span><br><span class="line"><span class="number">871</span>	<span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">06</span>:<span class="number">56</span>:<span class="number">16.069725</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	TCP	<span class="number">56</span>	<span class="number">51612</span> → <span class="number">8080</span> [ACK] Seq=<span class="number">220</span> Ack=<span class="number">5000169</span> Win=<span class="number">1045248</span> Len=<span class="number">0</span> TSval=<span class="number">4237985900</span> TSecr=<span class="number">3590463996</span></span><br></pre></td></tr></table></figure>

<ol>
<li>231 ~ 233번 패킷은 TCP 3 Way Handshake (syn, syn&#x2F;ack, ack)<img src="/2022/03/20/client-abort-exception-deep-dive-part-02/large-response-in-read-timeout-tcp-3-way-handshake.png" class>
<img src="/2022/03/20/client-abort-exception-deep-dive-part-02/tcp-3-way-handshake.png" class>
<img src="/2022/03/20/client-abort-exception-deep-dive-part-02/large-response-in-read-timeout-tcp-3-way-handshake-socket-status.png" class></li>
<li>235번 패킷에서 클라이언트 → 서버로 HTTP 요청 패킷 전송 (06:56:05.568288)<img src="/2022/03/20/client-abort-exception-deep-dive-part-02/large-response-in-read-timeout-send-http-request-packet.png" class></li>
<li>236번 패킷에서 서버가 요청 잘 받았다고 클라이언트한테 ACK 패킷 전송 (06:56:05.568329)<img src="/2022/03/20/client-abort-exception-deep-dive-part-02/large-response-in-read-timeout-send-http-request-ack-packet.png" class></li>
<li>237번 패킷은 서버에서 온 응답인데 ACK를 받은 06:56:05.5<code>68</code>329에서 Read Timeout으로 설정한 <code>25</code>ms 이전에 도착함 (06:56:05.5<code>82</code>682)<img src="/2022/03/20/client-abort-exception-deep-dive-part-02/large-response-in-read-timeout-send-http-response-packet-01.png" class></li>
<li>238 ~ 240번 패킷은 서버에서 응답 패킷을 쪼개서 보내고 있음 (06:56:05.582700 ~ 06:56:05.582730)<img src="/2022/03/20/client-abort-exception-deep-dive-part-02/large-response-in-read-timeout-send-http-response-packet-02.png" class></li>
<li>241번 패킷은 클라이언트가 서버한테 응답 패킷 잘 받았다고 ACK 패킷을 보내고 있음 (06:56:05.582740)<img src="/2022/03/20/client-abort-exception-deep-dive-part-02/large-response-in-read-timeout-send-http-response-ack-packet-01.png" class></li>
<li>858번 패킷은 마지막 응답 패킷인데 패킷 유실 때문인지 재전송을 하고 있다. (06:56:05.653137)<br>원래 클라이언트가 생각했던 Read Timeout 25ms는 최초 ACK를 받은 06:56:05.5<code>68</code>329 시점부터 계산해보면 06:56:05.5<code>93</code>329이다.<br>근데 마지막 응답 패킷이 온 걸 보면 06:56:05.<code>653</code>137으로 실제로는 ACK를 받은 시점으로부터 85ms가 흘렀다.<br>즉, Read Timeout은 클라이언트의 모든 요청을 받은 시간이 아닌 각 응답 패킷을 받는데까지 걸리는 시간이다.<img src="/2022/03/20/client-abort-exception-deep-dive-part-02/large-response-in-read-timeout-send-http-response-packet-03.png" class></li>
<li>859번 패킷에서 응답 패킷을 잘 받았다는 마지막 ACK 패킷을 서버에게 보내고 있다. (06:56:05.653169)<img src="/2022/03/20/client-abort-exception-deep-dive-part-02/large-response-in-read-timeout-send-http-response-ack-packet-02.png" class></li>
<li>866 ~ 871번 패킷은 TCP Connection Termination (FIN&#x2F;ACK&#x2F;FIN&#x2F;ACK)이다. (06:56:16.068837 ~ 06:56:16.069725)<br>클라이언트가 먼저 연결을 종료하겠다는 FIN 패킷을 보냈기 때문에 클라이언트가 Active Close<br>서버는 클라이언트로부터 FIN 패킷을 받았기 때문에 서버는 Passive Close가 됨<br>(무조건 클라이언트가 Active Close는 아니고 경우에 따라서 다름)<br>마지막 패킷을 받은 이후 10초 동안 메인 함수의 Thread.sleep을 했기 때문에 10초 이후에 메인 함수가 종료(프로세스가 종료)되면서 커넥션을 끊게 되는 것이다.<img src="/2022/03/20/client-abort-exception-deep-dive-part-02/large-response-in-read-timeout-tcp-connection-termination.png" class>
<img src="/2022/03/20/client-abort-exception-deep-dive-part-02/tcp-termination.png" class></li>
<li>소켓이 종료된 이후에 바로 해당 소켓이 사라지는 게 아니라 오동작을 막기 위해 30초(OS마다 다르지만 2 * MSL(Maximum Segment Lifetime, OS 커널 레벨에 하드코딩 돼있는데 대다수의 리눅스는 60로초 설정됨, 내가 쓰는 맥os는 30초)) 동안 TIME_WAIT 상태에서 대기를 함. (06:56:16)<img src="/2022/03/20/client-abort-exception-deep-dive-part-02/large-response-in-read-timeout-tcp-time-wait-socket-status.png" class></li>
<li>30초가 지나면 소켓이 사라지고 해당 소켓(로컬ip:로컬port, 서버ip:서버port 쌍)을 재사용 할 수 있다. (06:56:47)<img src="/2022/03/20/client-abort-exception-deep-dive-part-02/large-response-in-read-timeout-tcp-socket-status.png" class></li>
</ol>
<h2 id="2-각-응답-패킷의-시간-간격이-Read-Timeout-안에-오지-않은-경우"><a href="#2-각-응답-패킷의-시간-간격이-Read-Timeout-안에-오지-않은-경우" class="headerlink" title="2. 각 응답 패킷의 시간 간격이 Read Timeout 안에 오지 않은 경우"></a>2. 각 응답 패킷의 시간 간격이 Read Timeout 안에 오지 않은 경우</h2><p>서버 쪽 API에서 각 응답을 주는 패킷의 지연시간이 제각각이라고 가정</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StreamResponseController</span> &#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">val</span> executor = Executors.newCachedThreadPool()</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">val</span> log = LoggerFactory.getLogger(<span class="keyword">this</span>::<span class="keyword">class</span>.java)</span><br><span class="line"></span><br><span class="line">   <span class="meta">@GetMapping(<span class="string">&quot;/stream&quot;</span>)</span></span><br><span class="line">   <span class="function"><span class="keyword">fun</span> <span class="title">stream</span><span class="params">()</span></span>: ResponseEntity&lt;ResponseBodyEmitter&gt; &#123;</span><br><span class="line">      <span class="keyword">val</span> emitter = ResponseBodyEmitter()</span><br><span class="line">      executor.execute &#123;</span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">100L</span>)</span><br><span class="line">            emitter.send(<span class="string">&quot;hello, once&quot;</span>, MediaType.TEXT_PLAIN)</span><br><span class="line">            log.info(<span class="string">&quot;hello, once&quot;</span>)</span><br><span class="line"></span><br><span class="line">            Thread.sleep(<span class="number">100L</span>)</span><br><span class="line">            emitter.send(<span class="string">&quot;hello, twice&quot;</span>, MediaType.TEXT_PLAIN)</span><br><span class="line">            log.info(<span class="string">&quot;hello, twice&quot;</span>)</span><br><span class="line"></span><br><span class="line">            Thread.sleep(<span class="number">500L</span>) <span class="comment">// 최대 지연 시간</span></span><br><span class="line">            emitter.send(<span class="string">&quot;hello, thrice&quot;</span>, MediaType.TEXT_PLAIN)</span><br><span class="line">            log.info(<span class="string">&quot;hello, thrice&quot;</span>)</span><br><span class="line"></span><br><span class="line">            Thread.sleep(<span class="number">100L</span>)</span><br><span class="line">            emitter.send(<span class="string">&quot;bye&quot;</span>, MediaType.TEXT_PLAIN)</span><br><span class="line">            log.info(<span class="string">&quot;bye&quot;</span>)</span><br><span class="line"></span><br><span class="line">            emitter.complete()</span><br><span class="line">         &#125; <span class="keyword">catch</span> (e: Exception) &#123;</span><br><span class="line">            emitter.completeWithError(e)</span><br><span class="line">            log.error(e.message, e)</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> ResponseEntity(emitter, HttpStatus.OK)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>클라이언트 측은 서버 측 응답 패킷의 최대 지연 시간보다 짧게 Read Timeout을 설정함.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> readTimeout = Duration.ofMillis(<span class="number">200L</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> restTemplate = RestTemplate(</span><br><span class="line">        HttpComponentsClientHttpRequestFactory(</span><br><span class="line">            HttpClientBuilder</span><br><span class="line">                .create()</span><br><span class="line">                .setMaxConnPerRoute(<span class="number">100</span>)</span><br><span class="line">                .setMaxConnTotal(<span class="number">100</span>)</span><br><span class="line">                .setKeepAliveStrategy(DefaultConnectionKeepAliveStrategy())</span><br><span class="line">                .setDefaultRequestConfig(</span><br><span class="line">                    RequestConfig.custom().setSocketTimeout(readTimeout.toMillis().toInt()).build()</span><br><span class="line">                )</span><br><span class="line">                .build()</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        restTemplate.getForObject(<span class="string">&quot;http://localhost:8080/stream&quot;</span>, String::<span class="keyword">class</span>.java)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e: Exception) &#123;</span><br><span class="line">        e.printStackTrace()</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        println(<span class="string">&quot;[<span class="subst">$&#123;LocalDateTime.now()&#125;</span>] request is done!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 커넥션 풀에 있는 커넥션을 바로 종료하지 않기 위해 10초간 슬립</span></span><br><span class="line">    Thread.sleep(<span class="number">10_000L</span>)</span><br><span class="line">    println(<span class="string">&quot;[<span class="subst">$&#123;LocalDateTime.now()&#125;</span>] main function is done!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="데모-영상-1"><a href="#데모-영상-1" class="headerlink" title="데모 영상"></a>데모 영상</h3><div class="video-container"><iframe src="https://www.youtube.com/embed/k6o-3P3mwAY" frameborder="0" loading="lazy" allowfullscreen></iframe></div>

<h3 id="클라이언트-로그"><a href="#클라이언트-로그" class="headerlink" title="클라이언트 로그"></a>클라이언트 로그</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.248</span> [main] DEBUG org.springframework.web.client.RestTemplate - HTTP GET http:<span class="comment">//localhost:8080/stream</span></span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.254</span> [main] DEBUG org.springframework.web.client.RestTemplate - Accept=[text/plain, application/json, application<span class="comment">/*+json, */</span>*]</span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.282</span> [main] DEBUG org.apache.http.client.protocol.RequestAddCookies - CookieSpec selected: default</span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.285</span> [main] DEBUG org.apache.http.client.protocol.RequestAuthCache - Auth cache not <span class="keyword">set</span> <span class="keyword">in</span> the context</span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.285</span> [main] DEBUG org.apache.http.impl.conn.PoolingHttpClientConnectionManager - Connection request: [route: &#123;&#125;-&gt;http:<span class="comment">//localhost:8080][total available: 0; route allocated: 0 of 100; total allocated: 0 of 100]</span></span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.289</span> [main] DEBUG org.apache.http.impl.conn.PoolingHttpClientConnectionManager - Connection leased: [id: <span class="number">0</span>][route: &#123;&#125;-&gt;http:<span class="comment">//localhost:8080][total available: 0; route allocated: 1 of 100; total allocated: 1 of 100]</span></span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.290</span> [main] DEBUG org.apache.http.impl.execchain.MainClientExec - Opening connection &#123;&#125;-&gt;http:<span class="comment">//localhost:8080</span></span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.293</span> [main] DEBUG org.apache.http.impl.conn.DefaultHttpClientConnectionOperator - Connecting to localhost/<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8080</span></span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.294</span> [main] DEBUG org.apache.http.impl.conn.DefaultHttpClientConnectionOperator - Connection established <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">55447</span>&lt;-&gt;<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8080</span></span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.294</span> [main] DEBUG org.apache.http.impl.conn.DefaultManagedHttpClientConnection - http-outgoing-<span class="number">0</span>: <span class="keyword">set</span> socket timeout to <span class="number">200</span></span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.294</span> [main] DEBUG org.apache.http.impl.execchain.MainClientExec - Executing request GET /stream HTTP/<span class="number">1.1</span></span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.294</span> [main] DEBUG org.apache.http.impl.execchain.MainClientExec - Target auth state: UNCHALLENGED</span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.294</span> [main] DEBUG org.apache.http.impl.execchain.MainClientExec - Proxy auth state: UNCHALLENGED</span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.294</span> [main] DEBUG org.apache.http.headers - http-outgoing-<span class="number">0</span> &gt;&gt; GET /stream HTTP/<span class="number">1.1</span></span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.294</span> [main] DEBUG org.apache.http.headers - http-outgoing-<span class="number">0</span> &gt;&gt; Accept: text/plain, application/json, application<span class="comment">/*+json, */</span>*</span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.294</span> [main] DEBUG org.apache.http.headers - http-outgoing-<span class="number">0</span> &gt;&gt; Host: localhost:<span class="number">8080</span></span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.294</span> [main] DEBUG org.apache.http.headers - http-outgoing-<span class="number">0</span> &gt;&gt; Connection: Keep-Alive</span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.295</span> [main] DEBUG org.apache.http.headers - http-outgoing-<span class="number">0</span> &gt;&gt; User-Agent: Apache-HttpClient/<span class="number">4.5</span><span class="number">.13</span> (Java/<span class="number">1.8</span><span class="number">.0_322</span>)</span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.295</span> [main] DEBUG org.apache.http.headers - http-outgoing-<span class="number">0</span> &gt;&gt; Accept-Encoding: gzip,deflate</span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.295</span> [main] DEBUG org.apache.http.wire - http-outgoing-<span class="number">0</span> &gt;&gt; <span class="string">&quot;GET /stream HTTP/1.1[\r][\n]&quot;</span></span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.295</span> [main] DEBUG org.apache.http.wire - http-outgoing-<span class="number">0</span> &gt;&gt; <span class="string">&quot;Accept: text/plain, application/json, application/*+json, */*[\r][\n]&quot;</span></span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.295</span> [main] DEBUG org.apache.http.wire - http-outgoing-<span class="number">0</span> &gt;&gt; <span class="string">&quot;Host: localhost:8080[\r][\n]&quot;</span></span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.295</span> [main] DEBUG org.apache.http.wire - http-outgoing-<span class="number">0</span> &gt;&gt; <span class="string">&quot;Connection: Keep-Alive[\r][\n]&quot;</span></span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.295</span> [main] DEBUG org.apache.http.wire - http-outgoing-<span class="number">0</span> &gt;&gt; <span class="string">&quot;User-Agent: Apache-HttpClient/4.5.13 (Java/1.8.0_322)[\r][\n]&quot;</span></span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.295</span> [main] DEBUG org.apache.http.wire - http-outgoing-<span class="number">0</span> &gt;&gt; <span class="string">&quot;Accept-Encoding: gzip,deflate[\r][\n]&quot;</span></span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.295</span> [main] DEBUG org.apache.http.wire - http-outgoing-<span class="number">0</span> &gt;&gt; <span class="string">&quot;[\r][\n]&quot;</span></span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.401</span> [main] DEBUG org.apache.http.wire - http-outgoing-<span class="number">0</span> &lt;&lt; <span class="string">&quot;HTTP/1.1 200 [\r][\n]&quot;</span></span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.401</span> [main] DEBUG org.apache.http.wire - http-outgoing-<span class="number">0</span> &lt;&lt; <span class="string">&quot;Transfer-Encoding: chunked[\r][\n]&quot;</span></span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.401</span> [main] DEBUG org.apache.http.wire - http-outgoing-<span class="number">0</span> &lt;&lt; <span class="string">&quot;Date: Sun, 20 Mar 2022 01:04:13 GMT[\r][\n]&quot;</span></span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.401</span> [main] DEBUG org.apache.http.wire - http-outgoing-<span class="number">0</span> &lt;&lt; <span class="string">&quot;Keep-Alive: timeout=60[\r][\n]&quot;</span></span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.401</span> [main] DEBUG org.apache.http.wire - http-outgoing-<span class="number">0</span> &lt;&lt; <span class="string">&quot;Connection: keep-alive[\r][\n]&quot;</span></span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.401</span> [main] DEBUG org.apache.http.wire - http-outgoing-<span class="number">0</span> &lt;&lt; <span class="string">&quot;[\r][\n]&quot;</span></span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.401</span> [main] DEBUG org.apache.http.wire - http-outgoing-<span class="number">0</span> &lt;&lt; <span class="string">&quot;b[\r][\n]&quot;</span></span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.401</span> [main] DEBUG org.apache.http.wire - http-outgoing-<span class="number">0</span> &lt;&lt; <span class="string">&quot;hello, once[\r][\n]&quot;</span></span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.402</span> [main] DEBUG org.apache.http.headers - http-outgoing-<span class="number">0</span> &lt;&lt; HTTP/<span class="number">1.1</span> <span class="number">200</span> </span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.402</span> [main] DEBUG org.apache.http.headers - http-outgoing-<span class="number">0</span> &lt;&lt; Transfer-Encoding: chunked</span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.402</span> [main] DEBUG org.apache.http.headers - http-outgoing-<span class="number">0</span> &lt;&lt; Date: Sun, <span class="number">20</span> Mar <span class="number">2022</span> <span class="number">01</span>:<span class="number">04</span>:<span class="number">13</span> GMT</span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.402</span> [main] DEBUG org.apache.http.headers - http-outgoing-<span class="number">0</span> &lt;&lt; Keep-Alive: timeout=<span class="number">60</span></span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.402</span> [main] DEBUG org.apache.http.headers - http-outgoing-<span class="number">0</span> &lt;&lt; Connection: keep-alive</span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.404</span> [main] DEBUG org.apache.http.impl.execchain.MainClientExec - Connection can be kept alive <span class="keyword">for</span> <span class="number">60000</span> MILLISECONDS</span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.406</span> [main] DEBUG org.springframework.web.client.RestTemplate - Response <span class="number">200</span> OK</span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.407</span> [main] DEBUG org.springframework.web.client.RestTemplate - Reading to [java.lang.String] <span class="keyword">as</span> <span class="string">&quot;application/octet-stream&quot;</span></span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.506</span> [main] DEBUG org.apache.http.wire - http-outgoing-<span class="number">0</span> &lt;&lt; <span class="string">&quot;c[\r][\n]&quot;</span></span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.507</span> [main] DEBUG org.apache.http.wire - http-outgoing-<span class="number">0</span> &lt;&lt; <span class="string">&quot;hello, twice[\r][\n]&quot;</span></span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.712</span> [main] DEBUG org.apache.http.wire - http-outgoing-<span class="number">0</span> &lt;&lt; <span class="string">&quot;[read] I/O error: Read timed out&quot;</span></span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.712</span> [main] DEBUG org.apache.http.impl.conn.DefaultManagedHttpClientConnection - http-outgoing-<span class="number">0</span>: Close connection</span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.713</span> [main] DEBUG org.apache.http.impl.execchain.MainClientExec - Connection discarded</span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.713</span> [main] DEBUG org.apache.http.impl.conn.PoolingHttpClientConnectionManager - Connection released: [id: <span class="number">0</span>][route: &#123;&#125;-&gt;http:<span class="comment">//localhost:8080][total available: 0; route allocated: 0 of 100; total allocated: 0 of 100]</span></span><br><span class="line"><span class="number">10</span>:<span class="number">04</span>:<span class="number">13.715</span> [main] DEBUG org.apache.http.wire - http-outgoing-<span class="number">0</span> &lt;&lt; <span class="string">&quot;[read] I/O error: Socket closed&quot;</span></span><br><span class="line">[<span class="number">2022</span>-<span class="number">03</span>-20T10:<span class="number">04</span>:<span class="number">13.719</span>] request <span class="keyword">is</span> done!</span><br><span class="line">org.springframework.web.client.RestClientException: Error <span class="keyword">while</span> extracting response <span class="keyword">for</span> type [<span class="keyword">class</span> <span class="title class_">java</span>.<span class="title">lang</span>.<span class="title">String</span>] <span class="title">and</span> <span class="title">content</span> <span class="title">type</span> [<span class="title">application</span>/<span class="title">octet</span>-<span class="title">stream</span>]; <span class="title">nested</span> <span class="title">exception</span> <span class="title">is</span> <span class="title">java</span>.<span class="title">net</span>.<span class="title">SocketTimeoutException</span>: <span class="type">Read</span> <span class="title">timed</span> <span class="title">out</span></span><br><span class="line">	at org.springframework.web.client.HttpMessageConverterExtractor.extractData(HttpMessageConverterExtractor.java:<span class="number">120</span>)</span><br><span class="line">	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:<span class="number">778</span>)</span><br><span class="line">	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:<span class="number">711</span>)</span><br><span class="line">	at org.springframework.web.client.RestTemplate.getForObject(RestTemplate.java:<span class="number">334</span>)</span><br><span class="line">	at com.example.playground.StreamResponseRestTemplatePlaygroundKt.main(StreamResponseRestTemplatePlayground.kt:<span class="number">29</span>)</span><br><span class="line">	at com.example.playground.StreamResponseRestTemplatePlaygroundKt.main(StreamResponseRestTemplatePlayground.kt)</span><br><span class="line">Caused <span class="keyword">by</span>: java.net.SocketTimeoutException: Read timed <span class="keyword">out</span></span><br><span class="line">	at java.net.SocketInputStream.socketRead0(Native Method)</span><br><span class="line">	at java.net.SocketInputStream.socketRead(SocketInputStream.java:<span class="number">116</span>)</span><br><span class="line">	at java.net.SocketInputStream.read(SocketInputStream.java:<span class="number">171</span>)</span><br><span class="line">	at java.net.SocketInputStream.read(SocketInputStream.java:<span class="number">141</span>)</span><br><span class="line">	at org.apache.http.impl.conn.LoggingInputStream.read(LoggingInputStream.java:<span class="number">84</span>)</span><br><span class="line">	at org.apache.http.impl.io.SessionInputBufferImpl.streamRead(SessionInputBufferImpl.java:<span class="number">137</span>)</span><br><span class="line">	at org.apache.http.impl.io.SessionInputBufferImpl.fillBuffer(SessionInputBufferImpl.java:<span class="number">153</span>)</span><br><span class="line">	at org.apache.http.impl.io.SessionInputBufferImpl.readLine(SessionInputBufferImpl.java:<span class="number">280</span>)</span><br><span class="line">	at org.apache.http.impl.io.ChunkedInputStream.getChunkSize(ChunkedInputStream.java:<span class="number">261</span>)</span><br><span class="line">	at org.apache.http.impl.io.ChunkedInputStream.nextChunk(ChunkedInputStream.java:<span class="number">222</span>)</span><br><span class="line">	at org.apache.http.impl.io.ChunkedInputStream.read(ChunkedInputStream.java:<span class="number">183</span>)</span><br><span class="line">	at org.apache.http.conn.EofSensorInputStream.read(EofSensorInputStream.java:<span class="number">135</span>)</span><br><span class="line">	at java.io.FilterInputStream.read(FilterInputStream.java:<span class="number">133</span>)</span><br><span class="line">	at java.io.PushbackInputStream.read(PushbackInputStream.java:<span class="number">186</span>)</span><br><span class="line">	at sun.nio.cs.StreamDecoder.readBytes(StreamDecoder.java:<span class="number">284</span>)</span><br><span class="line">	at sun.nio.cs.StreamDecoder.implRead(StreamDecoder.java:<span class="number">326</span>)</span><br><span class="line">	at sun.nio.cs.StreamDecoder.read(StreamDecoder.java:<span class="number">178</span>)</span><br><span class="line">	at java.io.InputStreamReader.read(InputStreamReader.java:<span class="number">184</span>)</span><br><span class="line">	at java.io.Reader.read(Reader.java:<span class="number">140</span>)</span><br><span class="line">	at org.springframework.util.StreamUtils.copyToString(StreamUtils.java:<span class="number">91</span>)</span><br><span class="line">	at org.springframework.http.converter.StringHttpMessageConverter.readInternal(StringHttpMessageConverter.java:<span class="number">96</span>)</span><br><span class="line">	at org.springframework.http.converter.StringHttpMessageConverter.readInternal(StringHttpMessageConverter.java:<span class="number">44</span>)</span><br><span class="line">	at org.springframework.http.converter.AbstractHttpMessageConverter.read(AbstractHttpMessageConverter.java:<span class="number">199</span>)</span><br><span class="line">	at org.springframework.web.client.HttpMessageConverterExtractor.extractData(HttpMessageConverterExtractor.java:<span class="number">114</span>)</span><br><span class="line">	... <span class="number">5</span> more</span><br><span class="line">[<span class="number">2022</span>-<span class="number">03</span>-20T10:<span class="number">04</span>:<span class="number">23.725</span>] main function <span class="keyword">is</span> done!</span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure>

<ol>
<li>10:04:13.294에 서버와 커넥션 맺음. (<code>10:04:13.294 [main] DEBUG org.apache.http.impl.conn.DefaultHttpClientConnectionOperator - Connection established 127.0.0.1:55447&lt;-&gt;127.0.0.1:8080</code>)</li>
<li>10:04:13.295에 요청 전송 (<code>10:04:13.295 [main] DEBUG org.apache.http.headers - http-outgoing-0 &gt;&gt; ...</code>)</li>
<li>10:04:13.401에 첫 번째 응답이 옴 (대략 100ms 이후에 옴, <code>10:04:13.401 [main] DEBUG org.apache.http.wire - http-outgoing-0 &lt;&lt; &quot;hello, once[\r][\n]&quot;</code>)</li>
<li>10:04:13.507에 두 번째 응답이 옴 (대략 100ms 이후에 옴, <code>10:04:13.507 [main] DEBUG org.apache.http.wire - http-outgoing-0 &lt;&lt; &quot;hello, twice[\r][\n]&quot;</code>)</li>
<li>10:04:13.712에 Read Timeout 발생 (마지막 패킷이 온 이후로 정확히 우리가 설정한 200ms 후에 발생함, <code>10:04:13.712 [main] DEBUG org.apache.http.wire - http-outgoing-0 &lt;&lt; &quot;[read] I/O error: Read timed out&quot;</code>)</li>
<li>10:04:13.712 ~ 10:04:13.715에 커넥션 종료 (Keep-Alive 설정했음에도 불구하고, 정상적인 응답을 받지 못했으면 커넥션을 종료함. <code>10:04:13.712 [main] DEBUG org.apache.http.impl.conn.DefaultManagedHttpClientConnection - http-outgoing-0: Close connection</code>)</li>
<li>10:04:23.725에 메인함수 종료</li>
</ol>
<h3 id="서버-로그-1"><a href="#서버-로그-1" class="headerlink" title="서버 로그"></a>서버 로그</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">10</span>:<span class="number">04</span>:<span class="number">13.401</span>  INFO <span class="number">54891</span> --- [pool-<span class="number">1</span>-thread-<span class="number">3</span>] c.e.playground.StreamResponseController  : hello, once</span><br><span class="line"><span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">10</span>:<span class="number">04</span>:<span class="number">13.506</span>  INFO <span class="number">54891</span> --- [pool-<span class="number">1</span>-thread-<span class="number">3</span>] c.e.playground.StreamResponseController  : hello, twice</span><br><span class="line"><span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">10</span>:<span class="number">04</span>:<span class="number">14.012</span>  INFO <span class="number">54891</span> --- [pool-<span class="number">1</span>-thread-<span class="number">3</span>] c.e.playground.StreamResponseController  : hello, thrice</span><br><span class="line"><span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">10</span>:<span class="number">04</span>:<span class="number">14.118</span> ERROR <span class="number">54891</span> --- [pool-<span class="number">1</span>-thread-<span class="number">3</span>] c.e.playground.StreamResponseController  : java.io.IOException: Broken pipe</span><br><span class="line"></span><br><span class="line">org.apache.catalina.connector.ClientAbortException: java.io.IOException: Broken pipe</span><br><span class="line">	at org.apache.catalina.connector.OutputBuffer.doFlush(OutputBuffer.java:<span class="number">310</span>) ~[tomcat-embed-core-<span class="number">9.0</span><span class="number">.58</span>.jar:<span class="number">9.0</span><span class="number">.58</span>]</span><br><span class="line">	at org.apache.catalina.connector.OutputBuffer.flush(OutputBuffer.java:<span class="number">273</span>) ~[tomcat-embed-core-<span class="number">9.0</span><span class="number">.58</span>.jar:<span class="number">9.0</span><span class="number">.58</span>]</span><br><span class="line">	at org.apache.catalina.connector.CoyoteOutputStream.flush(CoyoteOutputStream.java:<span class="number">118</span>) ~[tomcat-embed-core-<span class="number">9.0</span><span class="number">.58</span>.jar:<span class="number">9.0</span><span class="number">.58</span>]</span><br><span class="line">	at sun.nio.cs.StreamEncoder.implFlush(StreamEncoder.java:<span class="number">297</span>) ~[na:<span class="number">1.8</span><span class="number">.0_322</span>]</span><br><span class="line">	at sun.nio.cs.StreamEncoder.flush(StreamEncoder.java:<span class="number">141</span>) ~[na:<span class="number">1.8</span><span class="number">.0_322</span>]</span><br><span class="line">	at java.io.OutputStreamWriter.flush(OutputStreamWriter.java:<span class="number">229</span>) ~[na:<span class="number">1.8</span><span class="number">.0_322</span>]</span><br><span class="line">	at org.springframework.util.StreamUtils.copy(StreamUtils.java:<span class="number">148</span>) ~[spring-core-<span class="number">5.3</span><span class="number">.16</span>.jar:<span class="number">5.3</span><span class="number">.16</span>]</span><br><span class="line">	at org.springframework.http.converter.StringHttpMessageConverter.writeInternal(StringHttpMessageConverter.java:<span class="number">126</span>) ~[spring-web-<span class="number">5.3</span><span class="number">.16</span>.jar:<span class="number">5.3</span><span class="number">.16</span>]</span><br><span class="line">	at org.springframework.http.converter.StringHttpMessageConverter.writeInternal(StringHttpMessageConverter.java:<span class="number">44</span>) ~[spring-web-<span class="number">5.3</span><span class="number">.16</span>.jar:<span class="number">5.3</span><span class="number">.16</span>]</span><br><span class="line">	at org.springframework.http.converter.AbstractHttpMessageConverter.write(AbstractHttpMessageConverter.java:<span class="number">227</span>) ~[spring-web-<span class="number">5.3</span><span class="number">.16</span>.jar:<span class="number">5.3</span><span class="number">.16</span>]</span><br><span class="line">	at org.springframework.web.servlet.mvc.method.<span class="keyword">annotation</span>.ResponseBodyEmitterReturnValueHandler$HttpMessageConvertingHandler.sendInternal(ResponseBodyEmitterReturnValueHandler.java:<span class="number">212</span>) ~[spring-webmvc-<span class="number">5.3</span><span class="number">.16</span>.jar:<span class="number">5.3</span><span class="number">.16</span>]</span><br><span class="line">	at org.springframework.web.servlet.mvc.method.<span class="keyword">annotation</span>.ResponseBodyEmitterReturnValueHandler$HttpMessageConvertingHandler.send(ResponseBodyEmitterReturnValueHandler.java:<span class="number">205</span>) ~[spring-webmvc-<span class="number">5.3</span><span class="number">.16</span>.jar:<span class="number">5.3</span><span class="number">.16</span>]</span><br><span class="line">	at org.springframework.web.servlet.mvc.method.<span class="keyword">annotation</span>.ResponseBodyEmitter.sendInternal(ResponseBodyEmitter.java:<span class="number">205</span>) ~[spring-webmvc-<span class="number">5.3</span><span class="number">.16</span>.jar:<span class="number">5.3</span><span class="number">.16</span>]</span><br><span class="line">	at org.springframework.web.servlet.mvc.method.<span class="keyword">annotation</span>.ResponseBodyEmitter.send(ResponseBodyEmitter.java:<span class="number">199</span>) ~[spring-webmvc-<span class="number">5.3</span><span class="number">.16</span>.jar:<span class="number">5.3</span><span class="number">.16</span>]</span><br><span class="line">	at com.example.playground.StreamResponseController.stream$lambda-<span class="number">0</span>(StreamResponseController.kt:<span class="number">35</span>) ~[main/:na]</span><br><span class="line">	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:<span class="number">1149</span>) ~[na:<span class="number">1.8</span><span class="number">.0_322</span>]</span><br><span class="line">	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:<span class="number">624</span>) ~[na:<span class="number">1.8</span><span class="number">.0_322</span>]</span><br><span class="line">	at java.lang.Thread.run(Thread.java:<span class="number">750</span>) ~[na:<span class="number">1.8</span><span class="number">.0_322</span>]</span><br><span class="line">Caused <span class="keyword">by</span>: java.io.IOException: Broken pipe</span><br><span class="line">	at sun.nio.ch.FileDispatcherImpl.write0(Native Method) ~[na:<span class="number">1.8</span><span class="number">.0_322</span>]</span><br><span class="line">	at sun.nio.ch.SocketDispatcher.write(SocketDispatcher.java:<span class="number">47</span>) ~[na:<span class="number">1.8</span><span class="number">.0_322</span>]</span><br><span class="line">	at sun.nio.ch.IOUtil.writeFromNativeBuffer(IOUtil.java:<span class="number">93</span>) ~[na:<span class="number">1.8</span><span class="number">.0_322</span>]</span><br><span class="line">	at sun.nio.ch.IOUtil.write(IOUtil.java:<span class="number">65</span>) ~[na:<span class="number">1.8</span><span class="number">.0_322</span>]</span><br><span class="line">	at sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:<span class="number">470</span>) ~[na:<span class="number">1.8</span><span class="number">.0_322</span>]</span><br><span class="line">	at org.apache.tomcat.util.net.NioChannel.write(NioChannel.java:<span class="number">135</span>) ~[tomcat-embed-core-<span class="number">9.0</span><span class="number">.58</span>.jar:<span class="number">9.0</span><span class="number">.58</span>]</span><br><span class="line">	at org.apache.tomcat.util.net.NioEndpoint$NioSocketWrapper.doWrite(NioEndpoint.java:<span class="number">1376</span>) ~[tomcat-embed-core-<span class="number">9.0</span><span class="number">.58</span>.jar:<span class="number">9.0</span><span class="number">.58</span>]</span><br><span class="line">	at org.apache.tomcat.util.net.SocketWrapperBase.doWrite(SocketWrapperBase.java:<span class="number">766</span>) ~[tomcat-embed-core-<span class="number">9.0</span><span class="number">.58</span>.jar:<span class="number">9.0</span><span class="number">.58</span>]</span><br><span class="line">	at org.apache.tomcat.util.net.SocketWrapperBase.flushBlocking(SocketWrapperBase.java:<span class="number">719</span>) ~[tomcat-embed-core-<span class="number">9.0</span><span class="number">.58</span>.jar:<span class="number">9.0</span><span class="number">.58</span>]</span><br><span class="line">	at org.apache.tomcat.util.net.SocketWrapperBase.flush(SocketWrapperBase.java:<span class="number">709</span>) ~[tomcat-embed-core-<span class="number">9.0</span><span class="number">.58</span>.jar:<span class="number">9.0</span><span class="number">.58</span>]</span><br><span class="line">	at org.apache.coyote.http11.Http11OutputBuffer$SocketOutputBuffer.flush(Http11OutputBuffer.java:<span class="number">573</span>) ~[tomcat-embed-core-<span class="number">9.0</span><span class="number">.58</span>.jar:<span class="number">9.0</span><span class="number">.58</span>]</span><br><span class="line">	at org.apache.coyote.http11.filters.ChunkedOutputFilter.flush(ChunkedOutputFilter.java:<span class="number">157</span>) ~[tomcat-embed-core-<span class="number">9.0</span><span class="number">.58</span>.jar:<span class="number">9.0</span><span class="number">.58</span>]</span><br><span class="line">	at org.apache.coyote.http11.Http11OutputBuffer.flush(Http11OutputBuffer.java:<span class="number">221</span>) ~[tomcat-embed-core-<span class="number">9.0</span><span class="number">.58</span>.jar:<span class="number">9.0</span><span class="number">.58</span>]</span><br><span class="line">	at org.apache.coyote.http11.Http11Processor.flush(Http11Processor.java:<span class="number">1255</span>) ~[tomcat-embed-core-<span class="number">9.0</span><span class="number">.58</span>.jar:<span class="number">9.0</span><span class="number">.58</span>]</span><br><span class="line">	at org.apache.coyote.AbstractProcessor.action(AbstractProcessor.java:<span class="number">402</span>) ~[tomcat-embed-core-<span class="number">9.0</span><span class="number">.58</span>.jar:<span class="number">9.0</span><span class="number">.58</span>]</span><br><span class="line">	at org.apache.coyote.Response.action(Response.java:<span class="number">209</span>) ~[tomcat-embed-core-<span class="number">9.0</span><span class="number">.58</span>.jar:<span class="number">9.0</span><span class="number">.58</span>]</span><br><span class="line">	at org.apache.catalina.connector.OutputBuffer.doFlush(OutputBuffer.java:<span class="number">306</span>) ~[tomcat-embed-core-<span class="number">9.0</span><span class="number">.58</span>.jar:<span class="number">9.0</span><span class="number">.58</span>]</span><br><span class="line">	... <span class="number">17</span> common frames omitted</span><br></pre></td></tr></table></figure>
<ol>
<li>10:04:13.401에 첫 번째 응답 전송</li>
<li>10:04:13.506에 두 번째 응답 전송 (100ms 지연)</li>
<li>10:04:14.012에 세 번째 응답 전송 (500ms 지연)</li>
<li>10:04:14.118에 <code>ClientAbortException(java.io.IOException: Broken pipe)</code> 발생</li>
<li>소켓이 종료된 상태에서 “bye”라는 응답 패킷을 전송하려다 발생함.</li>
</ol>
<h3 id="패킷-로그"><a href="#패킷-로그" class="headerlink" title="패킷 로그"></a>패킷 로그</h3><p>워낙 순식간에 지나가서 netstat으로 소켓의 상태는 관찰하지 못함.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">174</span>	<span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">10</span>:<span class="number">04</span>:<span class="number">13.293423</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	TCP	<span class="number">68</span>	<span class="number">55447</span> → <span class="number">8080</span> [SYN] Seq=<span class="number">0</span> Win=<span class="number">65535</span> Len=<span class="number">0</span> MSS=<span class="number">16344</span> WS=<span class="number">64</span> TSval=<span class="number">811634482</span> TSecr=<span class="number">0</span> SACK_PERM=<span class="number">1</span></span><br><span class="line"><span class="number">175</span>	<span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">10</span>:<span class="number">04</span>:<span class="number">13.293697</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	TCP	<span class="number">68</span>	<span class="number">8080</span> → <span class="number">55447</span> [SYN, ACK] Seq=<span class="number">0</span> Ack=<span class="number">1</span> Win=<span class="number">65535</span> Len=<span class="number">0</span> MSS=<span class="number">16344</span> WS=<span class="number">64</span> TSval=<span class="number">3020801649</span> TSecr=<span class="number">811634482</span> SACK_PERM=<span class="number">1</span></span><br><span class="line"><span class="number">176</span>	<span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">10</span>:<span class="number">04</span>:<span class="number">13.293717</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	TCP	<span class="number">56</span>	<span class="number">55447</span> → <span class="number">8080</span> [ACK] Seq=<span class="number">1</span> Ack=<span class="number">1</span> Win=<span class="number">408256</span> Len=<span class="number">0</span> TSval=<span class="number">811634482</span> TSecr=<span class="number">3020801649</span></span><br><span class="line"><span class="number">177</span>	<span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">10</span>:<span class="number">04</span>:<span class="number">13.293729</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	TCP	<span class="number">56</span>	[TCP Window Update] <span class="number">8080</span> → <span class="number">55447</span> [ACK] Seq=<span class="number">1</span> Ack=<span class="number">1</span> Win=<span class="number">408256</span> Len=<span class="number">0</span> TSval=<span class="number">3020801649</span> TSecr=<span class="number">811634482</span></span><br><span class="line"><span class="number">178</span>	<span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">10</span>:<span class="number">04</span>:<span class="number">13.295356</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	HTTP	<span class="number">275</span>	GET /stream HTTP/<span class="number">1.1</span> </span><br><span class="line"><span class="number">179</span>	<span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">10</span>:<span class="number">04</span>:<span class="number">13.295402</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	TCP	<span class="number">56</span>	<span class="number">8080</span> → <span class="number">55447</span> [ACK] Seq=<span class="number">1</span> Ack=<span class="number">220</span> Win=<span class="number">408064</span> Len=<span class="number">0</span> TSval=<span class="number">3020801651</span> TSecr=<span class="number">811634484</span></span><br><span class="line"><span class="number">180</span>	<span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">10</span>:<span class="number">04</span>:<span class="number">13.401563</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	TCP	<span class="number">202</span>	<span class="number">8080</span> → <span class="number">55447</span> [PSH, ACK] Seq=<span class="number">1</span> Ack=<span class="number">220</span> Win=<span class="number">408064</span> Len=<span class="number">146</span> TSval=<span class="number">3020801757</span> TSecr=<span class="number">811634484</span> [TCP segment of a reassembled PDU]</span><br><span class="line"><span class="number">181</span>	<span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">10</span>:<span class="number">04</span>:<span class="number">13.401620</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	TCP	<span class="number">56</span>	<span class="number">55447</span> → <span class="number">8080</span> [ACK] Seq=<span class="number">220</span> Ack=<span class="number">147</span> Win=<span class="number">408128</span> Len=<span class="number">0</span> TSval=<span class="number">811634590</span> TSecr=<span class="number">3020801757</span></span><br><span class="line"><span class="number">182</span>	<span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">10</span>:<span class="number">04</span>:<span class="number">13.506841</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	TCP	<span class="number">73</span>	<span class="number">8080</span> → <span class="number">55447</span> [PSH, ACK] Seq=<span class="number">147</span> Ack=<span class="number">220</span> Win=<span class="number">408064</span> Len=<span class="number">17</span> TSval=<span class="number">3020801863</span> TSecr=<span class="number">811634590</span> [TCP segment of a reassembled PDU]</span><br><span class="line"><span class="number">183</span>	<span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">10</span>:<span class="number">04</span>:<span class="number">13.506895</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	TCP	<span class="number">56</span>	<span class="number">55447</span> → <span class="number">8080</span> [ACK] Seq=<span class="number">220</span> Ack=<span class="number">164</span> Win=<span class="number">408128</span> Len=<span class="number">0</span> TSval=<span class="number">811634696</span> TSecr=<span class="number">3020801863</span></span><br><span class="line"><span class="number">184</span>	<span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">10</span>:<span class="number">04</span>:<span class="number">13.713445</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	TCP	<span class="number">56</span>	<span class="number">55447</span> → <span class="number">8080</span> [FIN, ACK] Seq=<span class="number">220</span> Ack=<span class="number">164</span> Win=<span class="number">408128</span> Len=<span class="number">0</span> TSval=<span class="number">811634902</span> TSecr=<span class="number">3020801863</span></span><br><span class="line"><span class="number">185</span>	<span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">10</span>:<span class="number">04</span>:<span class="number">13.713503</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	TCP	<span class="number">56</span>	<span class="number">8080</span> → <span class="number">55447</span> [ACK] Seq=<span class="number">164</span> Ack=<span class="number">221</span> Win=<span class="number">408064</span> Len=<span class="number">0</span> TSval=<span class="number">3020802069</span> TSecr=<span class="number">811634902</span></span><br><span class="line"><span class="number">186</span>	<span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">10</span>:<span class="number">04</span>:<span class="number">14.012150</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	TCP	<span class="number">74</span>	HTTP/<span class="number">1.1</span> <span class="number">200</span>   [TCP segment of a reassembled PDU]</span><br><span class="line"><span class="number">187</span>	<span class="number">2022</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">10</span>:<span class="number">04</span>:<span class="number">14.012215</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	TCP	<span class="number">44</span>	<span class="number">55447</span> → <span class="number">8080</span> [RST] Seq=<span class="number">221</span> Win=<span class="number">0</span> Len=<span class="number">0</span></span><br></pre></td></tr></table></figure>

<ol>
<li>174 ~ 176번 패킷은 TCP 3 Way Handshake (syn, syn&#x2F;ack, ack)<img src="/2022/03/20/client-abort-exception-deep-dive-part-02/stream-response-over-read-timeout-tcp-3-way-handshake.png" class>
<img src="/2022/03/20/client-abort-exception-deep-dive-part-02/tcp-3-way-handshake.png" class></li>
<li>178번 패킷에서 클라이언트 → 서버로 HTTP 요청 패킷 전송 (10:04:13.295356)<img src="/2022/03/20/client-abort-exception-deep-dive-part-02/stream-response-over-read-timeout-send-http-request-packet.png" class></li>
<li>179번 패킷에서 서버가 요청 잘 받았다고 클라이언트한테 ACK 패킷 전송 (10:04:13.295402)<img src="/2022/03/20/client-abort-exception-deep-dive-part-02/stream-response-over-read-timeout-send-http-request-ack-packet.png" class></li>
<li>180번 패킷은 서버에서 온 첫 번째 응답 패킷(hello, once)인데 ACK를 받은 10:04:13.<code>295</code>402에서 Read Timeout으로 설정한 <code>200</code>ms 이전에 도착함 (10:04:13.<code>401</code>563)<img src="/2022/03/20/client-abort-exception-deep-dive-part-02/stream-response-over-read-timeout-send-http-response-packet-01.png" class></li>
<li>181번 패킷은 서버에서 보낸 응답 패킷을 잘 받았다는 ACK 패킷을 클라이언트 -&gt; 서버로 보내고 있음. (10:04:13.401620)<img src="/2022/03/20/client-abort-exception-deep-dive-part-02/stream-response-over-read-timeout-send-http-response-ack-packet-01.png" class></li>
<li>182번 패킷은 서버에서 온 두 번째 응답 패킷(hello, twice)인데 마지막 응답 패킷(hello, once)을 받은 10:04:13.<code>401</code>563에서 Read Timeout으로 설정한 <code>200</code>ms 이전에 도착함 (10:04:13.<code>506</code>841)<img src="/2022/03/20/client-abort-exception-deep-dive-part-02/stream-response-over-read-timeout-send-http-response-packet-02.png" class></li>
<li>183번 패킷은 서버에서 보낸 응답 패킷을 잘 받았다는 ACK 패킷을 클라이언트 -&gt; 서버로 보내고 있음. (10:04:13.506895)<img src="/2022/03/20/client-abort-exception-deep-dive-part-02/stream-response-over-read-timeout-send-http-response-ack-packet-02.png" class></li>
<li>184번 패킷은 서버에서 온 마지막 응답 패킷(hello, twice)을 받은 10:04:13.<code>506</code>841에서 Read Timeout으로 설정한 <code>200</code>ms이 넘도록 아무런 패킷이 오지 않아 Read Timeout이 발생해서 서버 측에 FIN&#x2F;ACK 패킷을 날려서 커넥션을 종료할 준비를 하고 있음. (10:04:13.<code>713</code>445)<img src="/2022/03/20/client-abort-exception-deep-dive-part-02/stream-response-over-read-timeout-send-fin-packet.png" class></li>
<li>185번 패킷에서 서버가 클라이언트로부터 FIN&#x2F;ACK 패킷을 잘 받았다고 반대로 ACK 패킷을 클라이언트에게 보냄 (10:04:13.713503)<img src="/2022/03/20/client-abort-exception-deep-dive-part-02/stream-response-over-read-timeout-send-ack-packet.png" class></li>
<li>클라이언트가 먼저 연결을 종료하겠다는 FIN 패킷을 보냈기 때문에 클라이언트가 Active Close<br>서버는 클라이언트로부터 FIN 패킷을 받았기 때문에 서버는 Passive Close가 됨<br>(무조건 클라이언트가 Active Close는 아니고 경우에 따라서 다름)<br>그리고 아직까지는 서버(Passive Close)로부터 FIN 패킷을 받은 게 아니기 때문에 소켓이 정상적으로 종료된 게 아님.<img src="/2022/03/20/client-abort-exception-deep-dive-part-02/tcp-termination.png" class></li>
<li>186번 패킷에서 서버 → 클라이언트로 HTTP 세 번째 응답 패킷(hello, thrice) 전송 (10:04:14.<code>012</code>150, 마지막 응답 패킷(hello, twice)를 보낸 10:04:13.<code>506</code>841에서 500ms가 지난 시점임.)<img src="/2022/03/20/client-abort-exception-deep-dive-part-02/stream-response-over-read-timeout-send-http-response-packet-03.png" class></li>
<li>187번 패킷을 보면 서버에서 FIN 패킷이 온 게 아니기 때문에 클라이언트는 다시 서버에게 RST 패킷을 보내서 소켓을 닫을 준비를 한다. (10:04:14.012215) <img src="/2022/03/20/client-abort-exception-deep-dive-part-02/stream-response-over-read-timeout-send-rst-packet.png" class></li>
<li>소켓이 닫혔기 때문에 “bye”라는 응답패킷은 전송되지 않았다.</li>
</ol>
<h1 id="ClientAbortException을-해결하려면"><a href="#ClientAbortException을-해결하려면" class="headerlink" title="ClientAbortException을 해결하려면?"></a>ClientAbortException을 해결하려면?</h1><ol>
<li>서버 측에서 처리 속도를 더 빠르게 한다.</li>
<li>처리 속도는 빠르지만 응답이 크다면 응답의 사이즈를 줄인 API를 제공한다 (불필요한 필드 제거 or 페이징 API 제공)</li>
<li>클라이언트 측 리드 타임아웃 설정값을 늘린다.</li>
<li>정 합의가 안 된다면 ClientAbortException을 핸들링 해서 log.info로만 남긴다. (장애 상황은 아니라서 불필요한 노이즈라고 판단된다는 가정 하에)</li>
<li>클라이언트 측에서는 ReadTimeout이 발생했다면(ClientAbortException 여부와 상관 없이), 장애 상황(고객에게 돈은 출금이 됐는데 주문은 완료처리 안 됐다던지)을 막기 위해 서버 측에 취소 API 같은 걸 호출하거나 상태 조회 API 같은 걸 호출한 이후 내가 처리를 따로 해야하는 건지 아닌지 판단한 후에 올바른 처리를 해줘야한다.</li>
</ol>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Spring-Boot/" rel="tag"># Spring Boot</a>
              <a href="/tags/Tomcat/" rel="tag"># Tomcat</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/03/20/client-abort-exception-deep-dive-part-01/" rel="prev" title="(Tomcat) ClientAbortException은 왜 발생할까? (Part 1)">
                  <i class="fa fa-chevron-left"></i> (Tomcat) ClientAbortException은 왜 발생할까? (Part 1)
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/06/06/tdd-is-design-activity/" rel="next" title="TDD는 Design Acitivity이다.">
                  TDD는 Design Acitivity이다. <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2016 – 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="fa fa-user"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">양권성</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="external nofollow noopener noreferrer" target="_blank">NexT.Pisces</a>
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.0/dist/jquery.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.1/dist/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdn.jsdelivr.net/npm/mermaid@10.2.3/dist/mermaid.min.js","integrity":"sha256-JFptYy4KzJ5OQP+Q9fubNf3cxpPPmZKqUOovyEONKrQ="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>


  <script src="/js/third-party/fancybox.js"></script>



  




<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"exobud","count":true,"i18n":{"disqus":"disqus"}}</script>
<script src="/js/third-party/comments/disqus.js"></script>

</body>
</html>
